import{d as Ke,y as Ze,c as w,r as g,g as xe,a as n,m as _e,n as l,b as s,i as d,t as u,f as es,F as V,e as D,p as Y,s as O,x as Ie,u as k,v as X,q as se,k as ss,S as le,o as r,_ as ls}from"./index-uWeSuK_C.js";import{s as Te}from"./surveyService-BDce2LuR.js";import{u as as,T as ts,s as ns}from"./PublicSurveyView.module.css_vue_type_style_index_0_src_true_lang.module-Bqbhaew2.js";import{c as rs}from"./countryCodes-dG-LqG5W.js";const is=["data-theme"],us=["type","pattern","onUpdate:modelValue","maxlength","onBlur","onInput","placeholder"],os=["data-warning"],vs=["onUpdate:modelValue","maxlength","onInput"],ds=["data-warning"],ys=["onClick"],cs=["onClick"],ps={key:0,class:"fas fa-check"},fs=["onClick"],$s=["onClick"],ms=["onClick"],gs=["value"],ks=["onClick"],Cs=["disabled"],hs={key:0,class:"fas fa-spinner fa-spin"},bs={key:1,class:"fas fa-paper-plane"},ws={key:1},Is=["type","pattern","maxlength","placeholder"],Ts=["data-warning"],Ns=["maxlength"],Bs=["data-warning"],Ss=["onClick"],As=["onClick"],Es={key:0,class:"fas fa-check"},Ms=["onClick"],Vs=["aria-pressed"],Ds=["aria-pressed"],Ls=["onClick"],Os=["disabled"],Ws=["disabled"],Fs={key:0,class:"fas fa-spinner fa-spin"},Ps={key:1,class:"fas fa-paper-plane"},Us=400,Qs=2e3,Rs=Ke({__name:"PublicSurveyView",setup(Hs){const Ne=ss(),Be=Ze(),{getInputConfig:F,validateAnswer:Se,getValidationError:P,setValidationError:Ae,clearValidationError:ue,handleBackendValidationErrors:Ee}=as(),Me=w(()=>Be.currentTheme),p=g(null),ae=g(!0),j=g(!1),H=g(""),U=g(null),K=g(!1),h=g(0),v=g({}),L=g(""),S=g(!1),A=g(""),E=g(""),M=g("+971"),N=g(!1),W=g(""),m=g(""),z=g(!1),te=g(!1),oe=g(null),J=g(!1),Q=g(!0),q=rs,Ve=q.find(e=>e.dialCode==="+971")||q[0],i=w(()=>!p.value||!p.value.questions?null:p.value.questions[h.value]),De=w(()=>{var e;return p.value?(h.value+1)/(((e=p.value.questions)==null?void 0:e.length)||1)*100:0}),Le=w(()=>{if(!i.value)return!1;const e=v.value[i.value.id];return i.value.is_required?i.value.question_type==="multiple_choice"?Array.isArray(e)&&e.length>0:e!=null&&e!=="":!0}),ne=w(()=>{if(!p.value)return!1;for(const e of p.value.questions)if(e.is_required){const a=v.value[e.id];if(e.question_type==="multiple_choice"){if(!Array.isArray(a)||a.length===0)return!1}else if(a==null||a==="")return!1}return!0}),ve=w(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(A.value.trim())),de=w(()=>{const e=E.value.replace(/\D/g,""),a=M.value==="+971"?9:5;return e.length>=a&&e.length<=15}),ye=w(()=>M.value+E.value.trim().replace(/\s|-|[()]/g,"")),b=w(()=>{var e;return((e=p.value)==null?void 0:e.public_contact_method)||"email"}),re=w(()=>{var e;return((e=p.value)==null?void 0:e.per_device_access)===!0?!0:b.value==="email"?A.value.trim()!==""&&ve.value:b.value==="phone"?E.value.trim()!==""&&de.value:!1}),ce=w(()=>{if(!W.value.trim())return q;const e=W.value.toLowerCase().trim();return q.filter(a=>a.nameAr.toLowerCase().includes(e)||a.name.toLowerCase().includes(e)||a.dialCode.includes(e))}),ie=w(()=>q.find(e=>e.dialCode===M.value)||Ve),Oe=w(()=>{var e,a,o;return((e=p.value)==null?void 0:e.per_device_access)===!0?!1:h.value===(((o=(a=p.value)==null?void 0:a.questions)==null?void 0:o.length)||0)-1||z.value}),pe=()=>b.value==="email"?"fas fa-envelope":"fas fa-phone",fe=()=>b.value==="email"?"البريد الإلكتروني (مطلوب)":"رقم الهاتف (مطلوب)",$e=()=>b.value==="email"?"نحتاج بريدك الإلكتروني لحفظ إجاباتك وإرسال تأكيد المشاركة":"نحتاج رقم هاتفك لحفظ إجاباتك وإرسال تأكيد المشاركة",me=e=>{M.value=e.dialCode,N.value=!1,W.value=""},ge=e=>{const a=e.target;W.value=a.value},We=()=>{N.value=!1,W.value=""},Fe=async()=>{var e,a;try{ae.value=!0,J.value=!1;const o=Ne.params.token;if(!o){j.value=!0,H.value="لم يتم العثور على رمز الوصول";return}const y=new Promise(($,T)=>{setTimeout(()=>T(new Error("TIMEOUT")),15e3)}),f=await Promise.race([Te.validateAccess(o),y]);f.data.has_access&&f.data.survey?(p.value=f.data.survey,Ue()):(j.value=!0,U.value=f.data,H.value=f.message||"ليس لديك صلاحية للوصول إلى هذا الاستطلاع")}catch(o){if(j.value=!0,o.message==="TIMEOUT"){J.value=!0,H.value="انتهت مهلة الاتصال بالخادم";return}let y="فشل في تحميل الاستطلاع";if((e=o.response)!=null&&e.data){const f=o.response.data;f.message?y=f.message:(a=f.data)!=null&&a.message&&(y=f.data.message)}else o.message&&(y=o.message);H.value=y}finally{ae.value=!1}},Pe=()=>{window.location.reload()},Ue=()=>{if(!p.value)return;const e={};p.value.questions.forEach(a=>{a.question_type==="multiple_choice"?e[a.id]=[]:e[a.id]=""}),v.value=e},Qe=()=>{K.value=!0,h.value=0,L.value=""},Re=()=>{var e;He()&&h.value<(((e=p.value)==null?void 0:e.questions.length)||0)-1&&(h.value++,L.value="")},Xe=()=>{h.value>0&&(h.value--,L.value="")},He=()=>{if(!i.value)return!1;const e=v.value[i.value.id];if(i.value.is_required){if(i.value.question_type==="multiple_choice"){if(!Array.isArray(e)||e.length===0)return L.value="هذا السؤال مطلوب، يرجى الإجابة عليه",!1}else if(e==null||e==="")return L.value="هذا السؤال مطلوب، يرجى الإجابة عليه",!1}return L.value="",!0},ke=e=>{const a=v.value[e.id],o=e.validation_type||"none";if(o==="none")return;const y=Se(o,a||"",e.is_required);!y.valid&&y.error&&Ae(e.id,y.error)},ze=()=>{if(!re.value){if(b.value==="email"){if(A.value.trim()==="")return m.value="البريد الإلكتروني مطلوب للمتابعة",!1;if(!ve.value)return m.value="يرجى إدخال بريد إلكتروني صحيح",!1}else if(b.value==="phone"){if(E.value.trim()==="")return m.value="رقم الهاتف مطلوب للمتابعة",!1;if(!de.value){const e=M.value==="+971"?9:5;return m.value=M.value==="+971"?"يرجى إدخال رقم هاتف صحيح (9 أرقام للأرقام الإماراتية)":`يرجى إدخال رقم هاتف صحيح (${e} أرقام على الأقل)`,!1}}}return m.value="",!0},R=(e,a)=>{const o=v.value[e];return Array.isArray(o)&&o.includes(a)},Ce=(e,a)=>{Array.isArray(v.value[e])||(v.value[e]=[]);const o=[...v.value[e]],y=o.indexOf(a);y>-1?o.splice(y,1):o.push(a),v.value[e]=o},he=async()=>{var e,a,o,y,f;if(!(!ne.value||S.value)){if(((e=p.value)==null?void 0:e.per_device_access)!==!0&&!ze()){z.value=!0;return}try{S.value=!0;const $={survey_id:p.value.id,answers:Je()};((a=p.value)==null?void 0:a.per_device_access)!==!0&&(b.value==="email"?$.email=A.value.trim():b.value==="phone"&&($.phone=ye.value)),await Te.submitAnonymousResponse($),te.value=!0}catch($){if((f=(y=(o=$.response)==null?void 0:o.data)==null?void 0:y.data)!=null&&f.validation_errors){Ee($.response.data.data.validation_errors),le.fire({icon:"error",title:"خطأ في التحقق من صحة البيانات",text:"يرجى تصحيح الأخطاء في الاستطلاع والمحاولة مرة أخرى",confirmButtonText:"موافق"});return}let T="فشل في إرسال الاستطلاع";if($.message)if($.message.includes("Email is required")){m.value="البريد الإلكتروني مطلوب لهذا الاستطلاع",z.value=!0;return}else if($.message.includes("Phone is required")){m.value="رقم الهاتف مطلوب لهذا الاستطلاع",z.value=!0;return}else $.message.includes("already submitted")?T="لقد قمت بإرسال إجابة لهذا الاستطلاع من قبل":T=$.message;le.fire({icon:"error",title:"خطأ في الإرسال",text:T,confirmButtonText:"موافق"})}finally{S.value=!1}}},Je=()=>{const e=[];return Object.entries(v.value).forEach(([a,o])=>{if(o!==""&&o!==null&&o!==void 0){if(Array.isArray(o)&&o.length===0)return;e.push({question_id:a,answer:o})}}),e},qe=async()=>{try{const e=window.location.href;await navigator.clipboard.writeText(e),le.fire({icon:"success",title:"تم النسخ بنجاح",text:"تم نسخ الرابط بنجاح!",confirmButtonText:"موافق"})}catch{le.fire({icon:"error",title:"خطأ في النسخ",text:"فشل في نسخ الرابط",confirmButtonText:"موافق"})}},Ge=e=>{if(!e)return"1 إلى 5";try{const a=typeof e=="string"?JSON.parse(e):e;if(!Array.isArray(a)||a.length===0)return"1 إلى 5";const o=a.map($=>Number($)).filter($=>!isNaN($));if(o.length===0)return"1 إلى 5";const y=Math.min(...o),f=Math.max(...o);return`${y} إلى ${f}`}catch{return"1 إلى 5"}},be=e=>{if(!e)return[1,2,3,4,5];try{const a=typeof e=="string"?JSON.parse(e):e;if(!Array.isArray(a)||a.length===0)return[1,2,3,4,5];const o=a.map(y=>Number(y)).filter(y=>!isNaN(y)).sort((y,f)=>y-f);return o.length>0?o:a}catch{return[1,2,3,4,5]}},Z=e=>{if(!e)return[];try{const a=typeof e=="string"?JSON.parse(e):e;return Array.isArray(a)?a.map(o=>String(o)):[]}catch{return[]}},x=(e,a)=>{var y;const o=a||((y=i.value)==null?void 0:y.options);if(!o)return e==="min"?"ضعيف":"ممتاز";try{const f=typeof o=="string"?JSON.parse(o):o;if(!Array.isArray(f)||f.length===0)return e==="min"?"ضعيف":"ممتاز";const $=f.map(C=>Number(C)).filter(C=>!isNaN(C)).sort((C,c)=>C-c);if($.length===0)return e==="min"?"ضعيف":"ممتاز";const T=$[0],t=$[$.length-1];return e==="min"?T===1?"ضعيف جداً":T===0?"سيء":`الأدنى (${T})`:t===5?"ممتاز":t===10?"مثالي":`الأعلى (${t})`}catch{return e==="min"?"ضعيف":"ممتاز"}},Ye=()=>{te.value=!1,K.value=!1,A.value="",E.value="",M.value="+971",N.value=!1,W.value="",z.value=!1},B=e=>e==="textarea"?Qs:Us,G=e=>{const a=v.value[e];return a?String(a).length:0},I=(e,a)=>{const o=B(a),y=G(e);return o-y},_=(e,a,o)=>{const y=o.target,f=B(a);y.value.length>f&&(y.value=y.value.substring(0,f),v.value[e]=y.value)},we=e=>{try{return new Date(e).toLocaleDateString("ar",{calendar:"gregory",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}};return xe(()=>{Fe();const e=()=>{N.value&&We()};document.addEventListener("click",e);const a=()=>{document.removeEventListener("click",e)};window.__countryDropdownCleanup=a}),(e,a)=>{var o,y,f,$,T;return r(),n("div",{class:l(e.$style.publicSurveyContainer),"data-theme":Me.value,dir:"rtl"},[ae.value?(r(),n("div",{key:0,class:l(e.$style.loadingContainer)},[s("div",{class:l(e.$style.loadingSpinner)},null,2),s("p",{class:l(e.$style.loadingText)},"جاري تحميل الاستطلاع...",2)],2)):j.value?(r(),n("div",{key:1,class:l(e.$style.accessDenied)},[s("div",{class:l(e.$style.deniedIcon)},a[24]||(a[24]=[s("i",{class:"fas fa-lock"},null,-1)]),2),s("h2",{class:l(e.$style.deniedTitle)},"عذراً، الوصول مرفوض",2),s("p",{class:l(e.$style.deniedMessage)},u(H.value),3),U.value&&U.value.start_date&&U.value.end_date?(r(),n("div",{key:0,class:l(e.$style.scheduleInfo)},[s("div",{class:l(e.$style.scheduleItem)},[a[25]||(a[25]=s("i",{class:"fas fa-calendar-plus"},null,-1)),s("span",null,"تاريخ البداية: "+u(we(U.value.start_date)),1)],2),s("div",{class:l(e.$style.scheduleItem)},[a[26]||(a[26]=s("i",{class:"fas fa-calendar-times"},null,-1)),s("span",null,"تاريخ النهاية: "+u(we(U.value.end_date)),1)],2)],2)):d("",!0)],2)):p.value&&!K.value?(r(),n("div",{key:2,class:l(e.$style.surveyContent)},[s("div",{class:l(e.$style.surveyHeader)},[s("div",{class:l(e.$style.surveyBranding)},[s("h1",{class:l(e.$style.surveyTitle)},u(p.value.title),3),p.value.description?(r(),n("p",{key:0,class:l(e.$style.surveyDescription)},u(p.value.description),3)):d("",!0)],2),s("div",{class:l(e.$style.surveyMeta)},[s("div",{class:l(e.$style.metaItem)},[a[27]||(a[27]=s("i",{class:"fas fa-question-circle"},null,-1)),s("span",null,u(((o=p.value.questions)==null?void 0:o.length)||0)+" سؤال",1)],2),s("div",{class:l(e.$style.metaItem)},a[28]||(a[28]=[s("i",{class:"fas fa-users"},null,-1),s("span",null,"استطلاع عام",-1)]),2)],2)],2),s("div",{class:l(e.$style.welcomeSection)},[s("div",{class:l(e.$style.welcomeContent)},[s("div",{class:l(e.$style.welcomeIcon)},a[29]||(a[29]=[s("i",{class:"fas fa-heart"},null,-1)]),2),s("h3",{class:l(e.$style.welcomeTitle)},"أهلاً وسهلاً بك في استطلاعنا",2),s("p",{class:l(e.$style.welcomeText)}," نقدر وقتك وآرائك القيمة. إجاباتك ستساعدنا في تحسين خدماتنا وتطوير تجربة أفضل للجميع. الاستطلاع سهل وسريع، وجميع إجاباتك محفوظة بسرية تامة. ",2)],2)],2),s("div",{class:l(e.$style.actionButtons)},[s("button",{class:l(e.$style.startButton),onClick:Qe},a[30]||(a[30]=[s("i",{class:"fas fa-play"},null,-1),s("span",null,"ابدأ الاستطلاع الآن",-1)]),2),s("div",{class:l(e.$style.secondaryActions)},[s("button",{class:l(e.$style.secondaryButton),onClick:qe},a[31]||(a[31]=[s("i",{class:"fas fa-share"},null,-1),s("span",null,"شارك الرابط",-1)]),2)],2)],2)],2)):p.value&&K.value?(r(),n("div",{key:3,class:l(e.$style.surveyForm)},[s("div",{class:l(e.$style.formHeader)},[s("div",{class:l(e.$style.formTitleSection)},[s("h1",{class:l(e.$style.formTitle)},u(p.value.title),3),s("div",{class:l(e.$style.formSubtitle)},a[32]||(a[32]=[s("i",{class:"fas fa-user-edit"},null,-1),s("span",null,"يرجى الإجابة على الأسئلة التالية بعناية",-1)]),2)],2),s("div",{class:l(e.$style.viewModeToggle)},[s("button",{class:l([e.$style.toggleButton,{[e.$style.active]:Q.value}]),onClick:a[0]||(a[0]=t=>Q.value=!0),title:"عرض جميع الأسئلة في صفحة واحدة"},a[33]||(a[33]=[s("i",{class:"fas fa-list"},null,-1),s("span",null,"جميع الأسئلة",-1)]),2),s("button",{class:l([e.$style.toggleButton,{[e.$style.active]:!Q.value}]),onClick:a[1]||(a[1]=t=>Q.value=!1),title:"عرض سؤال واحد في كل مرة"},a[34]||(a[34]=[s("i",{class:"fas fa-file-alt"},null,-1),s("span",null,"سؤال بسؤال",-1)]),2)],2),Q.value?d("",!0):(r(),n("div",{key:0,class:l(e.$style.progressSection)},[s("div",{class:l(e.$style.progressBar)},[s("div",{class:l(e.$style.progressFill),style:es({width:De.value+"%"})},null,6)],2),s("div",{class:l(e.$style.progressInfo)},[s("span",{class:l(e.$style.progressText)}," السؤال "+u(h.value+1)+" من "+u(((y=p.value.questions)==null?void 0:y.length)||0),3)],2)],2))],2),Q.value?(r(),n("div",{key:0,class:l(e.$style.allQuestionsContainer)},[(r(!0),n(V,null,D(p.value.questions,(t,C)=>(r(),n("div",{key:t.id,class:l(e.$style.questionContainer)},[s("div",{class:l(e.$style.currentQuestion)},[s("div",{class:l(e.$style.questionHeader)},[s("div",{class:l(e.$style.questionBadge)},[s("span",{class:l(e.$style.questionIndex)},u(C+1),3)],2),s("h2",{class:l(e.$style.questionTitle)},[Y(u(t.text)+" ",1),t.is_required?(r(),n("span",{key:0,class:l(e.$style.required)},"*",2)):d("",!0)],2)],2),t.question_type==="text"?(r(),n("div",{key:0,class:l(e.$style.inputContainer)},[s("div",{class:l(e.$style.inputWrapper)},[O(s("input",{type:k(F)(t.validation_type||"none").type,pattern:k(F)(t.validation_type||"none").pattern,class:l([e.$style.textInput,{[e.$style.inputError]:k(P)(t.id)}]),"onUpdate:modelValue":c=>v.value[t.id]=c,maxlength:B("text"),onBlur:c=>ke(t),onInput:c=>{k(ue)(t.id),_(t.id,"text",c)},placeholder:k(F)(t.validation_type||"none").placeholder||"اكتب إجابتك هنا..."},null,42,us),[[Ie,v.value[t.id]]])],2),s("div",{class:l(e.$style.characterCount),"data-warning":I(t.id,"text")<100},[s("span",null,u(G(t.id))+" / "+u(B("text")),1),I(t.id,"text")<100?(r(),n("span",{key:0,class:l(e.$style.remainingWarning)}," ("+u(I(t.id,"text"))+" حرف متبقي) ",3)):d("",!0)],10,os),k(P)(t.id)?(r(),n("div",{key:0,class:l(e.$style.errorMessage)},[a[35]||(a[35]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),s("span",null,u(k(P)(t.id)),1)],2)):d("",!0)],2)):t.question_type==="textarea"?(r(),n("div",{key:1,class:l(e.$style.inputContainer)},[s("div",{class:l(e.$style.inputWrapper)},[O(s("textarea",{class:l(e.$style.textArea),"onUpdate:modelValue":c=>v.value[t.id]=c,maxlength:B("textarea"),onInput:c=>_(t.id,"textarea",c),placeholder:"اكتب إجابتك المفصلة هنا... يمكنك كتابة عدة أسطر",rows:"4"},null,42,vs),[[X,v.value[t.id]]])],2),s("div",{class:l(e.$style.characterCount),"data-warning":I(t.id,"textarea")<200},[s("span",null,u(G(t.id))+" / "+u(B("textarea")),1),I(t.id,"textarea")<200?(r(),n("span",{key:0,class:l(e.$style.remainingWarning)}," ("+u(I(t.id,"textarea"))+" حرف متبقي) ",3)):d("",!0)],10,ds)],2)):t.question_type==="single_choice"?(r(),n("div",{key:2,class:l(e.$style.choicesContainer)},[(r(!0),n(V,null,D(Z(t.options),(c,ee)=>(r(),n("div",{key:ee,class:l([e.$style.choiceOption,{[e.$style.selected]:v.value[t.id]===c}]),onClick:je=>v.value[t.id]=c},[s("div",{class:l(e.$style.choiceRadio)},[v.value[t.id]===c?(r(),n("div",{key:0,class:l(e.$style.radioSelected)},null,2)):d("",!0)],2),s("span",{class:l(e.$style.choiceText)},u(c),3),v.value[t.id]===c?(r(),n("div",{key:0,class:l(e.$style.choiceCheck)},a[36]||(a[36]=[s("i",{class:"fas fa-check"},null,-1)]),2)):d("",!0)],10,ys))),128))],2)):t.question_type==="multiple_choice"?(r(),n("div",{key:3,class:l(e.$style.choicesContainer)},[(r(!0),n(V,null,D(Z(t.options),(c,ee)=>(r(),n("div",{key:ee,class:l([e.$style.choiceOption,{[e.$style.selected]:R(t.id,c)}]),onClick:je=>Ce(t.id,c)},[s("div",{class:l(e.$style.choiceCheckbox)},[R(t.id,c)?(r(),n("i",ps)):d("",!0)],2),s("span",{class:l(e.$style.choiceText)},u(c),3),R(t.id,c)?(r(),n("div",{key:0,class:l(e.$style.choiceCheck)},a[37]||(a[37]=[s("i",{class:"fas fa-check-circle"},null,-1)]),2)):d("",!0)],10,cs))),128))],2)):t.question_type==="rating"?(r(),n("div",{key:4,class:l(e.$style.ratingContainer)},[s("div",{class:l(e.$style.ratingScale)},[(r(!0),n(V,null,D(be(t.options),c=>(r(),n("button",{key:c,class:l([e.$style.ratingButton,{[e.$style.selected]:v.value[t.id]===c}]),onClick:ee=>v.value[t.id]=c},[s("span",{class:l(e.$style.ratingNumber)},u(c),3)],10,fs))),128))],2),s("div",{class:l(e.$style.ratingLabels)},[s("span",null,u(x("min",t.options)),1),s("span",null,u(x("max",t.options)),1)],2)],2)):t.question_type==="yes_no"?(r(),n("div",{key:5,class:l(e.$style.yesNoWrapper)},[s("div",{class:l(e.$style.yesNoContainer)},[s("div",{class:l(e.$style.yesNoButtons)},[s("button",{class:l([e.$style.yesNoButton,e.$style.yes,{[e.$style.selected]:v.value[t.id]==="yes"}]),onClick:c=>v.value[t.id]="yes",type:"button"},[s("i",{class:l(["fas fa-check",e.$style.yesNoButtonIcon])},null,2),s("span",{class:l(e.$style.yesNoButtonText)},"نعم",2)],10,$s),s("button",{class:l([e.$style.yesNoButton,e.$style.no,{[e.$style.selected]:v.value[t.id]==="no"}]),onClick:c=>v.value[t.id]="no",type:"button"},[s("i",{class:l(["fas fa-times",e.$style.yesNoButtonIcon])},null,2),s("span",{class:l(e.$style.yesNoButtonText)},"لا",2)],10,ms)],2)],2)],2)):d("",!0)],2)],2))),128)),(f=p.value)!=null&&f.per_device_access?d("",!0):(r(),n("div",{key:0,class:l(e.$style.contactSection)},[s("div",{class:l(e.$style.questionContainer)},[s("div",{class:l(e.$style.currentQuestion)},[s("div",{class:l(e.$style.contactHeader)},[s("h3",{class:l(e.$style.contactTitle)},[s("i",{class:l(pe())},null,2),Y(" "+u(fe()),1)],2),s("p",{class:l(e.$style.contactDescription)},u($e()),3)],2),b.value==="email"?(r(),n("div",{key:0,class:l(e.$style.contactInputContainer)},[s("div",{class:l(e.$style.inputWrapper)},[O(s("input",{type:"email",class:l([e.$style.textInput,{[e.$style.error]:m.value}]),"onUpdate:modelValue":a[2]||(a[2]=t=>A.value=t),placeholder:"example@domain.com",onInput:a[3]||(a[3]=t=>m.value="")},null,34),[[X,A.value]])],2),m.value?(r(),n("div",{key:0,class:l(e.$style.contactError)},[a[38]||(a[38]=s("i",{class:"fas fa-exclamation-triangle"},null,-1)),s("span",null,u(m.value),1)],2)):d("",!0)],2)):b.value==="phone"?(r(),n("div",{key:1,class:l(e.$style.contactInputContainer)},[s("div",{class:l(e.$style.phoneInputWrapper)},[s("div",{class:l(e.$style.countrySelector),onClick:a[5]||(a[5]=se(()=>{},["stop"]))},[s("button",{class:l(e.$style.countryButton),onClick:a[4]||(a[4]=t=>N.value=!N.value),type:"button"},[s("span",{class:l(e.$style.countryFlag)},u(ie.value.flag),3),s("span",{class:l(e.$style.countryCode)},u(ie.value.dialCode),3),s("i",{class:l(["fas fa-chevron-down",e.$style.dropdownArrow])},null,2)],2),N.value?(r(),n("div",{key:0,class:l(e.$style.countryDropdown)},[s("div",{class:l(e.$style.searchWrapper)},[s("input",{ref_key:"countrySearchInput",ref:oe,type:"text",class:l(e.$style.searchInput),value:W.value,onInput:ge,placeholder:"ابحث عن دولة..."},null,42,gs),s("i",{class:l(["fas fa-search",e.$style.searchIcon])},null,2)],2),s("div",{class:l(e.$style.countriesList)},[(r(!0),n(V,null,D(ce.value,t=>(r(),n("div",{key:t.code,class:l(e.$style.countryItem),onClick:C=>me(t)},[s("span",{class:l(e.$style.countryFlag)},u(t.flag),3),s("span",{class:l(e.$style.countryName)},u(t.nameAr),3),s("span",{class:l(e.$style.countryDialCode)},u(t.dialCode),3)],10,ks))),128))],2)],2)):d("",!0)],2),s("div",{class:l(e.$style.inputWrapper)},[O(s("input",{type:"tel",class:l([e.$style.textInput,{[e.$style.error]:m.value}]),"onUpdate:modelValue":a[6]||(a[6]=t=>E.value=t),placeholder:"5XXXXXXXX",onInput:a[7]||(a[7]=t=>m.value="")},null,34),[[X,E.value]])],2)],2),m.value?(r(),n("div",{key:0,class:l(e.$style.contactError)},[a[39]||(a[39]=s("i",{class:"fas fa-exclamation-triangle"},null,-1)),s("span",null,u(m.value),1)],2)):d("",!0)],2)):d("",!0)],2)],2)],2)),s("div",{class:l(e.$style.submitContainer)},[s("button",{class:l([e.$style.navButton,e.$style.submit]),onClick:he,disabled:!ne.value||S.value||!re.value},[S.value?(r(),n("i",hs)):(r(),n("i",bs)),s("span",null,u(S.value?"جاري الإرسال...":"إرسال الاستطلاع"),1)],10,Cs)],2)],2)):(r(),n("div",ws,[s("div",{class:l(e.$style.questionContainer)},[i.value?(r(),n("div",{key:0,class:l(e.$style.currentQuestion)},[s("div",{class:l(e.$style.questionHeader)},[s("div",{class:l(e.$style.questionBadge)},[s("span",{class:l(e.$style.questionIndex)},u(h.value+1),3)],2),s("h2",{class:l(e.$style.questionTitle)},[Y(u(i.value.text)+" ",1),i.value.is_required?(r(),n("span",{key:0,class:l(e.$style.required)},"*",2)):d("",!0)],2),i.value.is_required?(r(),n("div",{key:0,class:l(e.$style.requiredNote)},a[40]||(a[40]=[s("i",{class:"fas fa-star"},null,-1),s("span",null,"هذا السؤال مطلوب",-1)]),2)):d("",!0)],2),i.value.question_type==="text"?(r(),n("div",{key:0,class:l(e.$style.inputContainer)},[s("div",{class:l(e.$style.inputWrapper)},[O(s("input",{type:k(F)(i.value.validation_type||"none").type,pattern:k(F)(i.value.validation_type||"none").pattern,class:l([e.$style.textInput,{[e.$style.inputError]:k(P)(i.value.id)}]),"onUpdate:modelValue":a[8]||(a[8]=t=>v.value[i.value.id]=t),maxlength:B("text"),onBlur:a[9]||(a[9]=t=>ke(i.value)),onInput:a[10]||(a[10]=t=>{i.value&&(k(ue)(i.value.id),_(i.value.id,"text",t))}),placeholder:k(F)(i.value.validation_type||"none").placeholder||"اكتب إجابتك هنا..."},null,42,Is),[[Ie,v.value[i.value.id]]])],2),s("div",{class:l(e.$style.characterCount),"data-warning":I(i.value.id,"text")<100},[s("span",null,u(G(i.value.id))+" / "+u(B("text")),1),I(i.value.id,"text")<100?(r(),n("span",{key:0,class:l(e.$style.remainingWarning)}," ("+u(I(i.value.id,"text"))+" حرف متبقي) ",3)):d("",!0)],10,Ts),k(P)(i.value.id)?(r(),n("div",{key:0,class:l(e.$style.errorMessage)},[a[41]||(a[41]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),s("span",null,u(k(P)(i.value.id)),1)],2)):d("",!0)],2)):i.value.question_type==="textarea"?(r(),n("div",{key:1,class:l(e.$style.inputContainer)},[s("div",{class:l(e.$style.inputWrapper)},[O(s("textarea",{class:l(e.$style.textArea),"onUpdate:modelValue":a[11]||(a[11]=t=>v.value[i.value.id]=t),maxlength:B("textarea"),onInput:a[12]||(a[12]=t=>{i.value&&_(i.value.id,"textarea",t)}),placeholder:"اكتب إجابتك المفصلة هنا... يمكنك كتابة عدة أسطر",rows:"4"},null,42,Ns),[[X,v.value[i.value.id]]])],2),s("div",{class:l(e.$style.characterCount),"data-warning":I(i.value.id,"textarea")<200},[s("span",null,u(G(i.value.id))+" / "+u(B("textarea")),1),I(i.value.id,"textarea")<200?(r(),n("span",{key:0,class:l(e.$style.remainingWarning)}," ("+u(I(i.value.id,"textarea"))+" حرف متبقي) ",3)):d("",!0)],10,Bs)],2)):i.value.question_type==="single_choice"?(r(),n("div",{key:2,class:l(e.$style.choicesContainer)},[s("div",{class:l(e.$style.choicesTitle)},a[42]||(a[42]=[s("i",{class:"fas fa-dot-circle"},null,-1),s("span",null,"اختر إجابة واحدة:",-1)]),2),(r(!0),n(V,null,D(Z(i.value.options),(t,C)=>(r(),n("div",{key:C,class:l([e.$style.choiceOption,{[e.$style.selected]:v.value[i.value.id]===t}]),onClick:c=>v.value[i.value.id]=t},[s("div",{class:l(e.$style.choiceRadio)},[v.value[i.value.id]===t?(r(),n("div",{key:0,class:l(e.$style.radioSelected)},null,2)):d("",!0)],2),s("span",{class:l(e.$style.choiceText)},u(t),3),v.value[i.value.id]===t?(r(),n("div",{key:0,class:l(e.$style.choiceCheck)},a[43]||(a[43]=[s("i",{class:"fas fa-check"},null,-1)]),2)):d("",!0)],10,Ss))),128))],2)):i.value.question_type==="multiple_choice"?(r(),n("div",{key:3,class:l(e.$style.choicesContainer)},[s("div",{class:l(e.$style.choicesTitle)},a[44]||(a[44]=[s("i",{class:"fas fa-check-square"},null,-1),s("span",null,"يمكنك اختيار أكثر من إجابة:",-1)]),2),(r(!0),n(V,null,D(Z(i.value.options),(t,C)=>(r(),n("div",{key:C,class:l([e.$style.choiceOption,{[e.$style.selected]:R(i.value.id,t)}]),onClick:c=>Ce(i.value.id,t)},[s("div",{class:l(e.$style.choiceCheckbox)},[R(i.value.id,t)?(r(),n("i",Es)):d("",!0)],2),s("span",{class:l(e.$style.choiceText)},u(t),3),R(i.value.id,t)?(r(),n("div",{key:0,class:l(e.$style.choiceCheck)},a[45]||(a[45]=[s("i",{class:"fas fa-check-circle"},null,-1)]),2)):d("",!0)],10,As))),128))],2)):i.value.question_type==="rating"?(r(),n("div",{key:4,class:l(e.$style.ratingContainer)},[s("div",{class:l(e.$style.ratingTitle)},[a[46]||(a[46]=s("i",{class:"fas fa-star"},null,-1)),s("span",null,"قيم من "+u(Ge(i.value.options))+":",1)],2),s("div",{class:l(e.$style.ratingScale)},[(r(!0),n(V,null,D(be(i.value.options),t=>(r(),n("button",{key:t,class:l([e.$style.ratingButton,{[e.$style.selected]:v.value[i.value.id]===t}]),onClick:C=>v.value[i.value.id]=t},[s("span",{class:l(e.$style.ratingNumber)},u(t),3)],10,Ms))),128))],2),s("div",{class:l(e.$style.ratingLabels)},[s("span",null,u(x("min")),1),s("span",null,u(x("max")),1)],2)],2)):i.value.question_type==="yes_no"?(r(),n("div",{key:5,class:l(e.$style.yesNoWrapper)},[s("div",{class:l(e.$style.yesNoTitle)},[s("i",{class:l(["fas fa-question-circle",e.$style.yesNoTitleIcon])},null,2),s("span",{class:l(e.$style.yesNoTitleText)},"سؤال اختيار",2)],2),s("div",{class:l(e.$style.yesNoSubtitle)},"اختر الخيار الذي يناسب رأيك",2),s("div",{class:l(e.$style.yesNoContainer)},[s("div",{class:l(e.$style.yesNoButtons)},[s("button",{class:l([e.$style.yesNoButton,e.$style.yes,{[e.$style.selected]:v.value[i.value.id]==="yes"}]),onClick:a[13]||(a[13]=t=>v.value[i.value.id]="yes"),type:"button","aria-pressed":v.value[i.value.id]==="yes"},[s("i",{class:l(["fas fa-check",e.$style.yesNoButtonIcon])},null,2),s("span",{class:l(e.$style.yesNoButtonText)},"نعم",2),s("div",{class:l(e.$style.yesNoButtonBadge)},a[47]||(a[47]=[s("i",{class:"fas fa-check"},null,-1)]),2)],10,Vs),s("button",{class:l([e.$style.yesNoButton,e.$style.no,{[e.$style.selected]:v.value[i.value.id]==="no"}]),onClick:a[14]||(a[14]=t=>v.value[i.value.id]="no"),type:"button","aria-pressed":v.value[i.value.id]==="no"},[s("i",{class:l(["fas fa-times",e.$style.yesNoButtonIcon])},null,2),s("span",{class:l(e.$style.yesNoButtonText)},"لا",2),s("div",{class:l(e.$style.yesNoButtonBadge)},a[48]||(a[48]=[s("i",{class:"fas fa-times"},null,-1)]),2)],10,Ds)],2)],2)],2)):d("",!0),L.value?(r(),n("div",{key:6,class:l(e.$style.errorMessage)},[a[49]||(a[49]=s("i",{class:"fas fa-exclamation-triangle"},null,-1)),s("span",null,u(L.value),1)],2)):d("",!0)],2)):d("",!0)],2),Oe.value?(r(),n("div",{key:0,class:l(e.$style.contactSection)},[s("div",{class:l(e.$style.contactContainer)},[s("div",{class:l(e.$style.contactHeader)},[s("h3",{class:l(e.$style.contactTitle)},[s("i",{class:l(pe())},null,2),Y(" "+u(fe()),1)],2),s("p",{class:l(e.$style.contactDescription)},u($e()),3)],2),b.value==="email"?(r(),n("div",{key:0,class:l(e.$style.contactInputContainer)},[s("div",{class:l(e.$style.contactInputWrapper)},[O(s("input",{type:"email",class:l([e.$style.contactInput,{[e.$style.error]:m.value}]),"onUpdate:modelValue":a[15]||(a[15]=t=>A.value=t),placeholder:"example@domain.com",onInput:a[16]||(a[16]=t=>m.value="")},null,34),[[X,A.value]]),s("i",{class:l(["fas fa-envelope",e.$style.contactIcon])},null,2)],2),m.value?(r(),n("div",{key:0,class:l(e.$style.contactError)},[a[50]||(a[50]=s("i",{class:"fas fa-exclamation-triangle"},null,-1)),s("span",null,u(m.value),1)],2)):d("",!0)],2)):b.value==="phone"?(r(),n("div",{key:1,class:l(e.$style.contactInputContainer)},[s("div",{class:l(e.$style.phoneInputWrapper)},[s("div",{class:l(e.$style.countrySelector),onClick:a[20]||(a[20]=se(()=>{},["stop"]))},[s("button",{class:l(e.$style.countryButton),onClick:a[17]||(a[17]=t=>N.value=!N.value),type:"button"},[s("span",{class:l(e.$style.countryFlag)},u(ie.value.flag),3),s("span",{class:l(e.$style.countryCode)},u(M.value),3),s("i",{class:l(["fas fa-chevron-down",e.$style.dropdownIcon])},null,2)],2),N.value?(r(),n("div",{key:0,class:l(e.$style.countryDropdown),onClick:a[19]||(a[19]=se(()=>{},["stop"]))},[s("div",{class:l(e.$style.dropdownSearch)},[s("input",{type:"text",class:l(e.$style.searchInput),placeholder:"البحث عن دولة...",onInput:ge,onClick:a[18]||(a[18]=se(()=>{},["stop"])),ref_key:"countrySearchInput",ref:oe},null,34),s("i",{class:l(["fas fa-search",e.$style.searchIcon])},null,2)],2),s("div",{class:l(e.$style.countriesList)},[(r(!0),n(V,null,D(ce.value,t=>(r(),n("button",{key:t.code,class:l([e.$style.countryOption,{[e.$style.selected]:M.value===t.dialCode}]),onClick:C=>me(t),type:"button"},[s("span",{class:l(e.$style.optionFlag)},u(t.flag),3),s("span",{class:l(e.$style.optionName)},u(t.nameAr),3),s("span",{class:l(e.$style.optionCode)},u(t.dialCode),3)],10,Ls))),128))],2)],2)):d("",!0)],2),s("div",{class:l(e.$style.phoneInputContainer),style:{transform:"translateY(10px)"}},[O(s("input",{type:"tel",class:l([e.$style.phoneInput,{[e.$style.error]:m.value}]),"onUpdate:modelValue":a[21]||(a[21]=t=>E.value=t),placeholder:"123456789",onInput:a[22]||(a[22]=t=>m.value=""),onFocus:a[23]||(a[23]=t=>N.value=!1)},null,34),[[X,E.value]])],2)],2),s("div",{class:l(e.$style.phonePreview)},[s("span",{class:l(e.$style.previewLabel)},"الرقم الكامل:",2),s("span",{class:l(e.$style.previewNumber)},u(ye.value),3)],2),m.value?(r(),n("div",{key:0,class:l(e.$style.contactError)},[a[51]||(a[51]=s("i",{class:"fas fa-exclamation-triangle"},null,-1)),s("span",null,u(m.value),1)],2)):d("",!0)],2)):d("",!0),s("div",{class:l(e.$style.contactNote)},a[52]||(a[52]=[s("i",{class:"fas fa-shield-alt"},null,-1),s("span",null,"بياناتك محمية ولن نشاركها مع أطراف خارجية",-1)]),2)],2)],2)):d("",!0),s("div",{class:l(e.$style.formNavigation)},[h.value<((($=p.value.questions)==null?void 0:$.length)||0)-1?(r(),n("button",{key:0,class:l([e.$style.navButton,e.$style.next]),onClick:Re,disabled:!Le.value},a[53]||(a[53]=[s("span",null,"السؤال التالي",-1),s("i",{class:"fas fa-arrow-left"},null,-1)]),10,Os)):d("",!0),h.value===(((T=p.value.questions)==null?void 0:T.length)||0)-1?(r(),n("button",{key:1,class:l([e.$style.navButton,e.$style.submit]),onClick:he,disabled:!ne.value||S.value||!re.value},[S.value?(r(),n("i",Fs)):(r(),n("i",Ps)),s("span",null,u(S.value?"جاري الإرسال...":"إرسال الاستطلاع"),1)],10,Ws)):d("",!0),s("div",{class:l(e.$style.navSpacer)},null,2),h.value>0?(r(),n("button",{key:2,class:l(e.$style.navButton),onClick:Xe},a[54]||(a[54]=[s("i",{class:"fas fa-arrow-right"},null,-1),s("span",null,"السؤال السابق",-1)]),2)):d("",!0)],2)]))],2)):(r(),n("div",{key:4,class:l(e.$style.errorState)},[s("div",{class:l(e.$style.errorIcon)},a[55]||(a[55]=[s("i",{class:"fas fa-exclamation-triangle"},null,-1)]),2),s("h2",{class:l(e.$style.errorTitle)},u(J.value?"انتهت مهلة الاتصال":"حدث خطأ غير متوقع"),3),s("p",{class:l(e.$style.errorMessage)},u(J.value?"انتهت مهلة الاتصال بالخادم. يرجى المحاولة مرة أخرى.":"عذراً، لم نتمكن من تحميل الاستطلاع. يرجى المحاولة مرة أخرى."),3),J.value?(r(),n("button",{key:0,class:l(e.$style.refreshButton),onClick:Pe,style:{background:"#007bff",color:"white",border:"none",padding:"12px 24px","border-radius":"8px","font-size":"16px",cursor:"pointer","margin-top":"20px",display:"flex","align-items":"center",gap:"8px",transition:"background-color 0.2s"}},a[56]||(a[56]=[s("i",{class:"fas fa-sync-alt"},null,-1),Y(" تحديث الصفحة ")]),2)):d("",!0)],2)),_e(k(ts),{isVisible:te.value,isFromPublicSurvey:!0,onClose:Ye},null,8,["isVisible"])],10,is)}}}),Xs={$style:ns},Ys=ls(Rs,[["__cssModules",Xs]]);export{Ys as default};
