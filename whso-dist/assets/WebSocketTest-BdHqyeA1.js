import{d as T,j as W,r as b,c as M,z as s,g as D,h as B,a as d,b as e,p as u,t as c,u as x,i as k,F as $,e as F,o as r}from"./index-uWeSuK_C.js";const O={style:{padding:"20px","max-width":"800px",margin:"0 auto"}},U={style:{"margin-bottom":"20px",padding:"15px","border-radius":"8px",background:"#f8f9fa"}},V={style:{"margin-bottom":"20px",padding:"15px","border-radius":"8px",background:"#e7f3ff",border:"1px solid #b3d9ff"}},z={key:0,style:{"margin-top":"10px",padding:"10px",background:"#fff","border-radius":"4px"}},A={style:{"margin-bottom":"20px",display:"flex",gap:"10px","flex-wrap":"wrap"}},E=["disabled"],J=["disabled"],R={style:{"margin-bottom":"20px"}},j={key:0,style:{padding:"20px","text-align":"center",color:"#666"}},I={style:{display:"flex","justify-content":"space-between","align-items":"flex-start"}},L={style:{flex:"1"}},G={style:{margin:"0 0 5px 0",color:"#2563eb"}},P={style:{margin:"0","font-size":"12px",color:"#666","white-space":"pre-wrap","word-wrap":"break-word"}},Y={style:{color:"#999",display:"block","margin-top":"8px"}},K=T({__name:"WebSocketTest",setup(q){const{isAuthenticated:h,user:y}=W(),i=b(""),l=b([]),p=M(()=>s.isNotificationWsConnected()),v=async()=>{try{await s.connectToNotifications()}catch(n){console.error("Failed to connect:",n)}},C=()=>{s.disconnectFromNotifications()},w=()=>{l.value=[]},N=()=>{i.value="ðŸ”„ Testing connection... Check browser console";const n=localStorage.getItem("access_token");if(!n){i.value="âŒ No authentication token found",console.error("âŒ Cannot test: No authentication token available");return}const t=new WebSocket(`ws://localhost:8000/ws/notifications/?token=${n}`);t.onopen=()=>{console.log("âœ… Connected"),i.value="âœ… Connected - Check console for details"},t.onmessage=o=>{const a=JSON.parse(o.data);console.log("ðŸ“¨ Received:",a),i.value="ðŸ“¨ Receiving messages - Check console"},t.onerror=o=>{console.error("âŒ WebSocket Error:",o),i.value="âŒ Connection error - Check console"},t.onclose=o=>{console.log("ðŸ”Œ Connection closed:",o.code,o.reason),i.value=`ðŸ”Œ Connection closed (${o.code})`},setTimeout(()=>{t.readyState===WebSocket.OPEN&&(t.close(),console.log("ðŸ›‘ Test connection closed after 10 seconds"))},1e4)},S=n=>{const o=Math.floor((new Date().getTime()-n.getTime())/1e3);if(o<1)return"Just now";if(o<60)return`${o} seconds ago`;if(o<3600){const a=Math.floor(o/60);return`${a} minute${a>1?"s":""} ago`}else return n.toLocaleTimeString()},f=n=>{l.value.unshift({type:"chat.unread.update",data:n,timestamp:new Date})},g=n=>{l.value.unshift({type:"notification.message",data:n,timestamp:new Date})},m=()=>{l.value.unshift({type:"connection.success",data:{message:"Connected to notification WebSocket"},timestamp:new Date})};return D(()=>{s.on("chat.unread.update",f),s.on("notification.message",g),s.on("notification.connected",m)}),B(()=>{s.off("chat.unread.update",f),s.off("notification.message",g),s.off("notification.connected",m)}),(n,t)=>{var o;return r(),d("div",O,[t[7]||(t[7]=e("h1",null,"WebSocket Notifications Test",-1)),e("div",U,[t[3]||(t[3]=e("h3",null,"Connection Status",-1)),e("p",null,[t[0]||(t[0]=e("strong",null,"Authenticated:",-1)),u(" "+c(x(h)?"âœ… Yes":"âŒ No"),1)]),e("p",null,[t[1]||(t[1]=e("strong",null,"User:",-1)),u(" "+c(((o=x(y))==null?void 0:o.email)||"Not logged in"),1)]),e("p",null,[t[2]||(t[2]=e("strong",null,"Global Notification WebSocket:",-1)),u(" "+c(p.value?"âœ… Connected":"âŒ Disconnected"),1)])]),e("div",V,[t[5]||(t[5]=e("h3",null,"Backend Verification Test",-1)),t[6]||(t[6]=e("p",{style:{margin:"5px 0",color:"#666","font-size":"14px"}}," Test direct WebSocket connection to backend (check browser console for logs) ",-1)),e("button",{onClick:N,style:{padding:"8px 16px","margin-top":"10px"}}," ðŸ§ª Test Backend WebSocket "),i.value?(r(),d("div",z,[t[4]||(t[4]=e("strong",null,"Status:",-1)),u(" "+c(i.value),1)])):k("",!0)]),e("div",A,[e("button",{onClick:v,disabled:p.value,style:{padding:"8px 16px"}}," Connect to Notifications ",8,E),e("button",{onClick:C,disabled:!p.value,style:{padding:"8px 16px"}}," Disconnect Notifications ",8,J),e("button",{onClick:w,style:{padding:"8px 16px"}}," Clear Messages ")]),e("div",R,[e("h3",null,"Real-time Messages ("+c(l.value.length)+")",1),l.value.length===0?(r(),d("div",j," No messages received yet. Once connected, you'll see chat unread updates and other notifications here. ")):k("",!0),(r(!0),d($,null,F(l.value,(a,_)=>(r(),d("div",{key:_,style:{"margin-bottom":"10px",padding:"15px",border:"1px solid #ddd","border-radius":"8px",background:"#f8f9fa"}},[e("div",I,[e("div",L,[e("h4",G,c(a.type),1),e("pre",P,c(JSON.stringify(a.data,null,2)),1),e("small",Y,c(S(a.timestamp)),1)])])]))),128))])])}}});export{K as default};
