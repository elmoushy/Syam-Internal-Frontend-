import{d as rs,y as us,c as T,r as c,g as is,a as n,m as os,n as l,b as s,q as ke,i as d,p as h,s as w,v as N,E as Ce,t as u,F as P,e as L,f as vs,x as Le,u as C,J as ds,k as ys,S as Ue,o as r,_ as cs}from"./index-uWeSuK_C.js";import{s as oe}from"./surveyService-BDce2LuR.js";import{u as ps,T as fs,s as $s}from"./PublicSurveyView.module.css_vue_type_style_index_0_src_true_lang.module-Bqbhaew2.js";import{c as ms}from"./countryCodes-dG-LqG5W.js";const gs=["data-theme"],ks=["onClick"],Cs=["disabled"],hs={key:1,class:"fas fa-unlock-alt"},ws=["type","pattern","onUpdate:modelValue","maxlength","onBlur","onInput","placeholder"],bs=["data-warning"],Ts=["onUpdate:modelValue","maxlength","onInput"],Is=["data-warning"],As=["onClick"],Ss=["onClick"],Bs={key:0,class:"fas fa-check"},Es=["onClick"],Ns=["onClick"],Ms=["onClick"],Vs=["value"],Ps=["disabled"],Ls={key:0,class:"fas fa-spinner fa-spin"},Us={key:1,class:"fas fa-paper-plane"},Fs={key:1},Os=["type","pattern","maxlength","placeholder"],Ds=["data-warning"],Ws=["maxlength"],Rs=["data-warning"],Qs=["onClick"],qs=["onClick"],Gs={key:0,class:"fas fa-check"},Hs=["onClick"],Js=["aria-pressed"],zs=["aria-pressed"],Ks=["onClick"],Xs=["disabled"],Ys=["disabled"],js={key:0,class:"fas fa-spinner fa-spin"},Zs={key:1,class:"fas fa-paper-plane"},xs=400,_s=2e3,el=rs({__name:"PasswordProtectedSurveyView",setup(ll){const ve=ys(),Fe=us(),{getInputConfig:J,validateAnswer:Oe,getValidationError:z,setValidationError:De,clearValidationError:he,handleBackendValidationErrors:We}=ps(),Re=T(()=>Fe.currentTheme),f=c(null),de=c(!0),ye=c(!1),D=c(!1),W=c(""),R=c(""),Q=c(""),K=c(""),X=c(""),Y=c(""),k=c(""),se=c(!1),ce=c(!1),pe=c(!1),ae=c(!1),j=c(!0),b=c(0),v=c({}),q=c(""),U=c(!1),F=c(""),O=c(""),S=c("+971"),I=c(!1),M=c(""),g=c(""),fe=c(!1),$e=c(!1),we=c(null),B=c(!1),Z=ms,Qe=Z.find(e=>e.dialCode==="+971")||Z[0],i=T(()=>!f.value||!f.value.questions?null:f.value.questions[b.value]),qe=T(()=>{var e;return f.value?(b.value+1)/(((e=f.value.questions)==null?void 0:e.length)||1)*100:0}),Ge=T(()=>!(!W.value.trim()||ce.value&&!R.value.trim()||pe.value&&!Q.value.trim())),He=T(()=>{if(!i.value)return!1;const e=v.value[i.value.id];return i.value.is_required?i.value.question_type==="multiple_choice"?Array.isArray(e)&&e.length>0:e!=null&&e!=="":!0}),me=T(()=>{if(!f.value)return!1;for(const e of f.value.questions)if(e.is_required){const a=v.value[e.id];if(e.question_type==="multiple_choice"){if(!Array.isArray(a)||a.length===0)return!1}else if(a==null||a==="")return!1}return!0}),x=T(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(F.value.trim())),_=T(()=>{const e=O.value.replace(/\D/g,""),a=S.value==="+971"?9:5;return e.length>=a&&e.length<=15}),Je=T(()=>S.value+O.value.trim().replace(/\s|-|[()]/g,"")),E=T(()=>{var e;return((e=f.value)==null?void 0:e.public_contact_method)||"email"}),be=T(()=>D.value?!0:E.value==="email"?F.value.trim()!==""&&x.value:E.value==="phone"?O.value.trim()!==""&&_.value:!1),Te=T(()=>{if(!M.value.trim())return Z;const e=M.value.toLowerCase().trim();return Z.filter(a=>a.nameAr.toLowerCase().includes(e)||a.name.toLowerCase().includes(e)||a.dialCode.includes(e))}),Ie=T(()=>Z.find(e=>e.dialCode===S.value)||Qe),ze=async()=>{var e,a;try{de.value=!0,B.value=!1;const o=ve.params.token;if(!o){k.value="لم يتم العثور على رمز الوصول";return}const p=new Promise((y,m)=>{setTimeout(()=>m(new Error("TIMEOUT")),15e3)});try{const y={password:"111"};await Promise.race([oe.validatePasswordAccessByToken(o,y),p])}catch(y){if(y.message==="TIMEOUT"){B.value=!0,k.value="انتهت مهلة الاتصال بالخادم";return}if(((e=y.response)==null?void 0:e.status)===404){k.value="هذا الاستطلاع لم يعد متاحًا";return}else if(((a=y.response)==null?void 0:a.status)!==401){k.value="فشل في التحقق من حالة الاستطلاع";return}}}catch(o){if(o.message==="TIMEOUT"){B.value=!0,k.value="انتهت مهلة الاتصال بالخادم";return}k.value="فشل في التحقق من متطلبات الوصول"}finally{de.value=!1}},Ae=()=>{window.location.reload()},te=async()=>{var e;try{se.value=!0,B.value=!1,Ke();const a=ve.params.token;if(!a){k.value="لم يتم العثور على رمز الوصول";return}if(!W.value.trim()){K.value="كلمة المرور مطلوبة";return}const o={password:W.value.trim()};R.value.trim()&&(o.email=R.value.trim()),Q.value.trim()&&(o.phone=S.value+Q.value.trim());const p=new Promise((m,G)=>{setTimeout(()=>G(new Error("TIMEOUT")),15e3)}),y=await Promise.race([oe.validatePasswordAccessByToken(a,o),p]);if(y.data.has_access){const m=y.data;(R.value.trim()||Q.value.trim())&&(D.value=!0);const G=m.survey_id,H=m.access_instructions.required_headers.Authorization.replace("Bearer ","");sessionStorage.setItem("survey_auth_token",H),sessionStorage.setItem("survey_password",W.value.trim());const t=await Promise.race([oe.getPasswordProtectedSurvey(G,H,W.value.trim()),p]);f.value=t.data,ye.value=!0,Xe()}else k.value="لا يمكن الوصول إلى هذا الاستطلاع"}catch(a){if(a.message==="TIMEOUT"){B.value=!0,k.value="انتهت مهلة الاتصال بالخادم";return}if((e=a.response)!=null&&e.data){const o=a.response.data;o.message?o.message.includes("email is required")?(ce.value=!0,X.value="البريد الإلكتروني مطلوب للوصول إلى هذا الاستطلاع"):o.message.includes("phone is required")?(pe.value=!0,Y.value="رقم الهاتف مطلوب للوصول إلى هذا الاستطلاع"):o.message.includes("password")?K.value="كلمة المرور غير صحيحة":o.message.includes("email")?X.value="البريد الإلكتروني غير صحيح أو غير مخول للوصول":o.message.includes("phone")?Y.value="رقم الهاتف غير صحيح أو غير مخول للوصول":k.value=o.message:k.value="فشل في الوصول إلى الاستطلاع"}else k.value="حدث خطأ غير متوقع"}finally{se.value=!1}},Ke=()=>{K.value="",X.value="",Y.value="",k.value=""},Xe=()=>{if(!f.value)return;const e={};f.value.questions.forEach(a=>{a.question_type==="multiple_choice"?e[a.id]=[]:e[a.id]=""}),v.value=e},Ye=()=>{ae.value=!0,b.value=0,q.value=""},je=()=>{var e;xe()&&b.value<(((e=f.value)==null?void 0:e.questions.length)||0)-1&&(b.value++,q.value="")},Ze=()=>{b.value>0&&(b.value--,q.value="")},xe=()=>{if(!i.value)return!1;const e=v.value[i.value.id];if(i.value.is_required){if(i.value.question_type==="multiple_choice"){if(!Array.isArray(e)||e.length===0)return q.value="يرجى اختيار خيار واحد على الأقل",!1}else if(e==null||e==="")return q.value="هذا السؤال مطلوب",!1}return q.value="",!0},Se=e=>{const a=v.value[e.id],o=e.validation_type||"none";if(o==="none")return;const p=Oe(o,a||"",e.is_required);!p.valid&&p.error&&De(e.id,p.error)},_e=()=>{if(D.value)return!0;if(E.value==="email"){if(F.value.trim()==="")return g.value="البريد الإلكتروني مطلوب",!1;if(!x.value)return g.value="يرجى إدخال بريد إلكتروني صحيح",!1}else if(E.value==="phone"){if(O.value.trim()==="")return g.value="رقم الهاتف مطلوب",!1;if(!_.value)return g.value="يرجى إدخال رقم هاتف صحيح",!1}return g.value="",!0},ge=(e,a)=>{const o=v.value[e];return Array.isArray(o)&&o.includes(a)},Be=(e,a)=>{Array.isArray(v.value[e])||(v.value[e]=[]);const o=[...v.value[e]],p=o.indexOf(a);p>-1?o.splice(p,1):o.push(a),v.value[e]=o},Ee=async()=>{var e,a,o,p;if(!(!me.value||U.value)){if(!D.value&&!_e()){fe.value=!0;return}try{U.value=!0;const y={survey_id:f.value.id,token:ve.params.token,password:W.value,answers:es()};D.value?(R.value&&(y.email=R.value),Q.value&&(y.phone=S.value+Q.value)):E.value==="email"?y.email=F.value.trim():E.value==="phone"&&(y.phone=Je.value),await oe.submitPasswordProtectedResponse(y),$e.value=!0}catch(y){if((o=(a=(e=y.response)==null?void 0:e.data)==null?void 0:a.data)!=null&&o.validation_errors){We(y.response.data.data.validation_errors),await Ue.fire({title:"خطأ في التحقق من صحة البيانات",text:"يرجى تصحيح الأخطاء في الاستطلاع والمحاولة مرة أخرى",icon:"error",confirmButtonText:"موافق"});return}let m="فشل في إرسال الاستطلاع";((p=y.response)==null?void 0:p.status)===403?m="هذا الشخص غير مصرح له بارسال الاجابات":y.message&&(y.message.includes("already submitted")?m="لقد قمت بإرسال إجابة لهذا الاستطلاع من قبل":m=y.message),Ue.fire({icon:"error",title:"خطأ في الإرسال",text:m,confirmButtonText:"موافق"})}finally{U.value=!1}}},es=()=>{const e=[];return Object.entries(v.value).forEach(([a,o])=>{if(o!==""&&o!==null&&o!==void 0){if(Array.isArray(o)&&o.length===0)return;e.push({question_id:a,answer:o})}}),e},ne=e=>{if(!e)return[];try{const a=typeof e=="string"?JSON.parse(e):e;return Array.isArray(a)?a.map(o=>String(o)):[]}catch{return[]}},Ne=e=>{if(!e)return[1,2,3,4,5];try{const a=typeof e=="string"?JSON.parse(e):e;return!Array.isArray(a)||a.length===0?[1,2,3,4,5]:(a.length>0,a)}catch{return[1,2,3,4,5]}},re=(e,a)=>{var p;const o=a||((p=i.value)==null?void 0:p.options);if(!o)return e==="min"?"ضعيف":"ممتاز";try{const y=typeof o=="string"?JSON.parse(o):o;if(!Array.isArray(y)||y.length===0)return e==="min"?"ضعيف":"ممتاز";const m=y;if(m.length===0)return e==="min"?"ضعيف":"ممتاز";const G=m[0],H=m[m.length-1];return e==="min"?`الأدنى (${G})`:`الأعلى (${H})`}catch{return e==="min"?"ضعيف":"ممتاز"}},Me=e=>{if(!e)return"1 إلى 5";try{const a=typeof e=="string"?JSON.parse(e):e;if(!Array.isArray(a)||a.length===0)return"1 إلى 5";const o=a.map(m=>Number(m)).filter(m=>!isNaN(m));if(o.length===0)return"1 إلى 5";const p=Math.min(...o),y=Math.max(...o);return`${p} إلى ${y}`}catch{return"1 إلى 5"}},Ve=e=>{S.value=e.dialCode,I.value=!1,M.value=""},Pe=e=>{const a=e.target;M.value=a.value},ss=()=>E.value==="email"?"fas fa-envelope":"fas fa-phone",ls=()=>E.value==="email"?"البريد الإلكتروني (مطلوب)":"رقم الهاتف (مطلوب)",as=()=>E.value==="email"?"نحتاج بريدك الإلكتروني لحفظ إجاباتك وإرسال تأكيد المشاركة":"نحتاج رقم هاتفك لحفظ إجاباتك وإرسال تأكيد المشاركة",ts=()=>{$e.value=!1,ae.value=!1,F.value="",O.value="",S.value="+971",I.value=!1,M.value="",fe.value=!1},V=e=>e==="textarea"?_s:xs,le=e=>{const a=v.value[e];return a?String(a).length:0},A=(e,a)=>{const o=V(a),p=le(e);return o-p},ue=(e,a,o)=>{const p=o.target,y=V(a);p.value.length>y&&(p.value=p.value.substring(0,y),v.value[e]=p.value)};return is(()=>{ze();const e=()=>{I.value&&(I.value=!1,M.value="")};document.addEventListener("click",e);const a=()=>{document.removeEventListener("click",e)};window.__countryDropdownCleanup=a}),(e,a)=>{var o,p,y,m,G,H;return r(),n("div",{class:l(e.$style.publicSurveyContainer),"data-theme":Re.value,dir:"rtl"},[de.value?(r(),n("div",{key:0,class:l(e.$style.loadingContainer)},[s("div",{class:l(e.$style.loadingSpinner)},null,2),s("p",{class:l(e.$style.loadingText)},"جاري تحميل الاستطلاع...",2)],2)):!ye.value&&!k.value?(r(),n("div",{key:1,class:l(e.$style.passwordAccessForm)},[s("div",{class:l(e.$style.accessCard)},[s("div",{class:l(e.$style.accessHeader)},[s("div",{class:l(e.$style.lockIconContainer)},[s("div",{class:l(e.$style.lockIcon)},a[27]||(a[27]=[s("i",{class:"fas fa-shield-alt"},null,-1)]),2)],2),s("h2",{class:l(e.$style.accessTitle)},"الاستطلاع محمي بكلمة مرور",2),s("p",{class:l(e.$style.accessDescription)},"يرجى إدخال كلمة المرور والمعلومات المطلوبة للوصول إلى الاستطلاع",2)],2),s("form",{class:l(e.$style.accessForm),onSubmit:ke(te,["prevent"])},[s("div",{class:l(e.$style.inputGroup)},[s("label",{class:l(e.$style.inputLabel)},a[28]||(a[28]=[s("i",{class:"fas fa-key"},null,-1),h(" كلمة المرور ")]),2),s("div",{class:l(e.$style.inputWrapper)},[w(s("input",{type:"password","onUpdate:modelValue":a[0]||(a[0]=t=>W.value=t),class:l([e.$style.textInput,{[e.$style.error]:K.value}]),placeholder:"أدخل كلمة المرور",onKeydown:Ce(te,["enter"])},null,34),[[N,W.value]]),s("div",{class:l(e.$style.inputFocus)},null,2)],2),K.value?(r(),n("div",{key:0,class:l(e.$style.errorMessage)},[a[29]||(a[29]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),h(" "+u(K.value),1)],2)):d("",!0)],2),ce.value?(r(),n("div",{key:0,class:l(e.$style.inputGroup)},[s("label",{class:l(e.$style.inputLabel)},a[30]||(a[30]=[s("i",{class:"fas fa-envelope"},null,-1),h(" البريد الإلكتروني ")]),2),s("div",{class:l(e.$style.inputWrapper)},[w(s("input",{type:"email","onUpdate:modelValue":a[1]||(a[1]=t=>R.value=t),class:l([e.$style.textInput,{[e.$style.error]:X.value}]),placeholder:"أدخل البريد الإلكتروني المطلوب",onKeydown:Ce(te,["enter"])},null,34),[[N,R.value]]),s("div",{class:l(e.$style.inputFocus)},null,2)],2),X.value?(r(),n("div",{key:0,class:l(e.$style.errorMessage)},[a[31]||(a[31]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),h(" "+u(X.value),1)],2)):d("",!0)],2)):d("",!0),pe.value?(r(),n("div",{key:1,class:l(e.$style.inputGroup)},[s("label",{class:l(e.$style.inputLabel)},a[32]||(a[32]=[s("i",{class:"fas fa-phone"},null,-1),h(" رقم الهاتف ")]),2),s("div",{class:l(e.$style.phoneInputContainer)},[s("div",{class:l(e.$style.countrySelector),onClick:a[4]||(a[4]=t=>I.value=!I.value)},[s("span",{class:l(e.$style.countryFlag)},u(Ie.value.flag),3),s("span",{class:l(e.$style.countryCode)},u(S.value),3),s("i",{class:l(["fas fa-chevron-down",{[e.$style.rotated]:I.value}])},null,2),I.value?(r(),n("div",{key:0,class:l(e.$style.countryDropdown),onClick:a[3]||(a[3]=ke(()=>{},["stop"]))},[s("div",{class:l(e.$style.countrySearch)},[w(s("input",{ref_key:"countrySearchInput",ref:we,type:"text",class:l(e.$style.searchInput),placeholder:"البحث...","onUpdate:modelValue":a[2]||(a[2]=t=>M.value=t),onInput:Pe},null,34),[[N,M.value]])],2),s("div",{class:l(e.$style.countryList)},[(r(!0),n(P,null,L(Te.value,t=>(r(),n("div",{key:t.dialCode,class:l(e.$style.countryItem),onClick:ee=>Ve(t)},[s("span",{class:l(e.$style.countryFlag)},u(t.flag),3),s("span",{class:l(e.$style.countryName)},u(t.nameAr),3),s("span",{class:l(e.$style.countryCode)},u(t.dialCode),3)],10,ks))),128))],2)],2)):d("",!0)],2),s("div",{class:l(e.$style.inputWrapper)},[w(s("input",{type:"tel","onUpdate:modelValue":a[5]||(a[5]=t=>Q.value=t),class:l([e.$style.phoneInput,{[e.$style.error]:Y.value}]),placeholder:"أدخل رقم الهاتف",onKeydown:Ce(te,["enter"])},null,34),[[N,Q.value]]),s("div",{class:l(e.$style.inputFocus)},null,2)],2)],2),Y.value?(r(),n("div",{key:0,class:l(e.$style.errorMessage)},[a[33]||(a[33]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),h(" "+u(Y.value),1)],2)):d("",!0)],2)):d("",!0),k.value?(r(),n("div",{key:2,class:l(e.$style.accessErrorMessage)},[s("div",{class:l(e.$style.errorIcon)},a[34]||(a[34]=[s("i",{class:"fas fa-exclamation-triangle"},null,-1)]),2),s("span",null,u(k.value),1)],2)):d("",!0),s("button",{type:"submit",class:l([e.$style.accessButton,{[e.$style.loading]:se.value}]),disabled:se.value||!Ge.value},[se.value?(r(),n("div",{key:0,class:l(e.$style.loadingSpinner)},null,2)):(r(),n("i",hs)),a[35]||(a[35]=s("span",null,"دخول الاستطلاع",-1))],10,Cs)],34)],2)],2)):f.value&&!ae.value?(r(),n("div",{key:2,class:l(e.$style.surveyContent)},[s("div",{class:l(e.$style.surveyHeader)},[s("div",{class:l(e.$style.surveyBranding)},[s("h1",{class:l(e.$style.surveyTitle)},u(f.value.title),3),s("p",{class:l(e.$style.surveyDescription)},u(f.value.description),3)],2),s("div",{class:l(e.$style.surveyMeta)},[s("div",{class:l(e.$style.metaItem)},a[36]||(a[36]=[s("i",{class:"fas fa-shield-alt"},null,-1),s("span",null,"استطلاع محمي",-1)]),2),s("div",{class:l(e.$style.metaItem)},[a[37]||(a[37]=s("i",{class:"fas fa-questions"},null,-1)),s("span",null,u(((o=f.value.questions)==null?void 0:o.length)||0)+" سؤال",1)],2)],2)],2),s("div",{class:l(e.$style.welcomeSection)},[s("div",{class:l(e.$style.welcomeContent)},[s("h2",{class:l(e.$style.welcomeTitle)},"مرحباً بك في الاستطلاع",2),s("p",{class:l(e.$style.welcomeText)}," نشكرك لمشاركتك في هذا الاستطلاع المحمي. إجاباتك مهمة بالنسبة لنا وستساعدنا في تحسين خدماتنا. ",2),s("ul",{class:l(e.$style.welcomePoints)},[a[39]||(a[39]=s("li",null,[s("i",{class:"fas fa-check-circle"}),h(" جميع إجاباتك آمنة ومحمية")],-1)),s("li",null,[a[38]||(a[38]=s("i",{class:"fas fa-clock"},null,-1)),h(" سيستغرق الاستطلاع حوالي "+u(Math.ceil((((p=f.value.questions)==null?void 0:p.length)||0)*.5))+" دقائق",1)]),a[40]||(a[40]=s("li",null,[s("i",{class:"fas fa-user-shield"}),h(" المشاركة بموافقتك الكاملة")],-1))],2)],2)],2),s("div",{class:l(e.$style.actionButtons)},[s("button",{class:l(e.$style.startButton),onClick:Ye},a[41]||(a[41]=[s("i",{class:"fas fa-play"},null,-1),h(" بدء الاستطلاع ")]),2)],2)],2)):f.value&&ae.value?(r(),n("div",{key:3,class:l(e.$style.surveyForm)},[s("div",{class:l(e.$style.formHeader)},[s("div",{class:l(e.$style.formTitleSection)},[s("h2",{class:l(e.$style.formTitle)},u(f.value.title),3),s("p",{class:l(e.$style.formSubtitle)},"استطلاع محمي",2)],2),s("div",{class:l(e.$style.viewModeToggle)},[s("button",{class:l([e.$style.toggleButton,{[e.$style.active]:j.value}]),onClick:a[6]||(a[6]=t=>j.value=!0)},a[42]||(a[42]=[s("i",{class:"fas fa-list"},null,-1),s("span",null,"جميع الأسئلة",-1)]),2),s("button",{class:l([e.$style.toggleButton,{[e.$style.active]:!j.value}]),onClick:a[7]||(a[7]=t=>j.value=!1)},a[43]||(a[43]=[s("i",{class:"fas fa-step-forward"},null,-1),s("span",null,"سؤال بسؤال",-1)]),2)],2),j.value?d("",!0):(r(),n("div",{key:0,class:l(e.$style.progressSection)},[s("div",{class:l(e.$style.progressBar)},[s("div",{class:l(e.$style.progressFill),style:vs({width:`${qe.value}%`})},null,6)],2),s("span",{class:l(e.$style.progressText)},u(b.value+1)+" من "+u(((y=f.value.questions)==null?void 0:y.length)||0),3)],2))],2),j.value?(r(),n("div",{key:0,class:l(e.$style.allQuestionsContainer)},[(r(!0),n(P,null,L(f.value.questions,(t,ee)=>(r(),n("div",{key:t.id,class:l(e.$style.currentQuestion)},[s("div",{class:l(e.$style.questionHeader)},[s("div",{class:l(e.$style.questionBadge)},[s("span",{class:l(e.$style.questionIndex)},u(ee+1),3)],2),s("h2",{class:l(e.$style.questionTitle)},[h(u(t.text)+" ",1),t.is_required?(r(),n("span",{key:0,class:l(e.$style.required)},"*",2)):d("",!0)],2),t.is_required?(r(),n("div",{key:0,class:l(e.$style.requiredNote)},a[44]||(a[44]=[s("i",{class:"fas fa-star"},null,-1),s("span",null,"هذا السؤال مطلوب",-1)]),2)):d("",!0)],2),t.question_type==="text"?(r(),n("div",{key:0,class:l(e.$style.inputContainer)},[s("div",{class:l(e.$style.inputWrapper)},[w(s("input",{type:C(J)(t.validation_type||"none").type,pattern:C(J)(t.validation_type||"none").pattern,class:l([e.$style.textInput,{[e.$style.inputError]:C(z)(t.id)}]),"onUpdate:modelValue":$=>v.value[t.id]=$,maxlength:V("text"),onBlur:$=>Se(t),onInput:$=>{C(he)(t.id),ue(t.id,"text",$)},placeholder:C(J)(t.validation_type||"none").placeholder||"اكتب إجابتك هنا..."},null,42,ws),[[Le,v.value[t.id]]])],2),s("div",{class:l(e.$style.characterCount),"data-warning":A(t.id,"text")<100},[s("span",null,u(le(t.id))+" / "+u(V("text")),1),A(t.id,"text")<100?(r(),n("span",{key:0,class:l(e.$style.remainingWarning)}," ("+u(A(t.id,"text"))+" حرف متبقي) ",3)):d("",!0)],10,bs),C(z)(t.id)?(r(),n("div",{key:0,class:l(e.$style.errorMessage)},[a[45]||(a[45]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),s("span",null,u(C(z)(t.id)),1)],2)):d("",!0)],2)):t.question_type==="textarea"?(r(),n("div",{key:1,class:l(e.$style.inputContainer)},[s("div",{class:l(e.$style.inputWrapper)},[w(s("textarea",{class:l(e.$style.textArea),"onUpdate:modelValue":$=>v.value[t.id]=$,maxlength:V("textarea"),onInput:$=>ue(t.id,"textarea",$),placeholder:"اكتب إجابتك المفصلة هنا... يمكنك كتابة عدة أسطر",rows:"4"},null,42,Ts),[[N,v.value[t.id]]])],2),s("div",{class:l(e.$style.characterCount),"data-warning":A(t.id,"textarea")<200},[s("span",null,u(le(t.id))+" / "+u(V("textarea")),1),A(t.id,"textarea")<200?(r(),n("span",{key:0,class:l(e.$style.remainingWarning)}," ("+u(A(t.id,"textarea"))+" حرف متبقي) ",3)):d("",!0)],10,Is)],2)):t.question_type==="single_choice"?(r(),n("div",{key:2,class:l(e.$style.choicesContainer)},[s("div",{class:l(e.$style.choicesTitle)},a[46]||(a[46]=[s("i",{class:"fas fa-dot-circle"},null,-1),s("span",null,"اختر إجابة واحدة:",-1)]),2),(r(!0),n(P,null,L(ne(t.options),($,ie)=>(r(),n("div",{key:ie,class:l([e.$style.choiceOption,{[e.$style.selected]:v.value[t.id]===$}]),onClick:ns=>v.value[t.id]=$},[s("div",{class:l(e.$style.choiceRadio)},[v.value[t.id]===$?(r(),n("div",{key:0,class:l(e.$style.radioSelected)},null,2)):d("",!0)],2),s("span",{class:l(e.$style.choiceText)},u($),3),v.value[t.id]===$?(r(),n("div",{key:0,class:l(e.$style.choiceCheck)},a[47]||(a[47]=[s("i",{class:"fas fa-check"},null,-1)]),2)):d("",!0)],10,As))),128))],2)):t.question_type==="multiple_choice"?(r(),n("div",{key:3,class:l(e.$style.choicesContainer)},[s("div",{class:l(e.$style.choicesTitle)},a[48]||(a[48]=[s("i",{class:"fas fa-check-square"},null,-1),s("span",null,"يمكنك اختيار أكثر من إجابة:",-1)]),2),(r(!0),n(P,null,L(ne(t.options),($,ie)=>(r(),n("div",{key:ie,class:l([e.$style.choiceOption,{[e.$style.multiSelected]:Array.isArray(v.value[t.id])&&v.value[t.id].includes($)}]),onClick:ns=>Be(t.id,$)},[s("div",{class:l(e.$style.choiceCheckbox)},[Array.isArray(v.value[t.id])&&v.value[t.id].includes($)?(r(),n("i",Bs)):d("",!0)],2),s("span",{class:l(e.$style.choiceText)},u($),3)],10,Ss))),128))],2)):t.question_type==="rating"?(r(),n("div",{key:4,class:l(e.$style.ratingContainer)},[s("div",{class:l(e.$style.ratingTitle)},[a[49]||(a[49]=s("i",{class:"fas fa-star"},null,-1)),s("span",null,"قيم من "+u(Me(t.options))+":",1)],2),s("div",{class:l(e.$style.ratingScale)},[(r(!0),n(P,null,L(Ne(t.options),$=>(r(),n("button",{key:$,class:l([e.$style.ratingButton,{[e.$style.selected]:v.value[t.id]===$}]),onClick:ie=>v.value[t.id]=$},[s("span",{class:l(e.$style.ratingNumber)},u($),3)],10,Es))),128))],2),s("div",{class:l(e.$style.ratingLabels)},[s("span",null,u(re("min",t.options)),1),s("span",null,u(re("max",t.options)),1)],2)],2)):t.question_type==="yes_no"?(r(),n("div",{key:5,class:l(e.$style.yesNoContainer)},[s("button",{class:l([e.$style.yesNoButton,e.$style.yesButton,{[e.$style.selected]:v.value[t.id]==="yes"}]),onClick:$=>v.value[t.id]="yes"},a[50]||(a[50]=[s("i",{class:"fas fa-check-circle"},null,-1),s("span",null,"نعم",-1)]),10,Ns),s("button",{class:l([e.$style.yesNoButton,e.$style.noButton,{[e.$style.selected]:v.value[t.id]==="no"}]),onClick:$=>v.value[t.id]="no"},a[51]||(a[51]=[s("i",{class:"fas fa-times-circle"},null,-1),s("span",null,"لا",-1)]),10,Ms)],2)):d("",!0)],2))),128)),f.value.public_contact_method?(r(),n("div",{key:0,class:l(e.$style.currentQuestion)},[s("div",{class:l(e.$style.questionHeader)},[s("div",{class:l(e.$style.questionBadge)},a[52]||(a[52]=[s("i",{class:"fas fa-id-card"},null,-1)]),2),s("h2",{class:l(e.$style.questionTitle)},"معلومات الاتصال",2),s("p",{class:l(e.$style.contactNote)},a[53]||(a[53]=[s("i",{class:"fas fa-info-circle"},null,-1),s("span",null,"يرجى تقديم معلومات الاتصال الخاصة بك",-1)]),2)],2),s("div",{class:l(e.$style.contactFormContainer)},[f.value.public_contact_method==="email"?(r(),n("div",{key:0,class:l(e.$style.contactField)},[s("label",{class:l(e.$style.contactLabel)},a[54]||(a[54]=[s("i",{class:"fas fa-envelope"},null,-1),s("span",null,"البريد الإلكتروني *",-1)]),2),s("div",{class:l(e.$style.inputWrapper)},[w(s("input",{type:"email","onUpdate:modelValue":a[8]||(a[8]=t=>F.value=t),class:l([e.$style.textInput,{[e.$style.error]:g.value&&!x.value}]),placeholder:"example@domain.com",onInput:a[9]||(a[9]=t=>g.value="")},null,34),[[N,F.value]]),s("i",{class:l(["fas fa-at",e.$style.inputIcon])},null,2)],2),g.value&&!x.value?(r(),n("div",{key:0,class:l(e.$style.contactErrorMessage)},u(g.value),3)):d("",!0)],2)):f.value.public_contact_method==="phone"?(r(),n("div",{key:1,class:l(e.$style.contactField)},[s("label",{class:l(e.$style.contactLabel)},a[55]||(a[55]=[s("i",{class:"fas fa-phone"},null,-1),s("span",null,"رقم الهاتف *",-1)]),2),s("div",{class:l(e.$style.phoneInputGroup)},[s("div",{class:l(e.$style.countryCodeWrapper)},[w(s("select",{"onUpdate:modelValue":a[10]||(a[10]=t=>S.value=t),class:l(e.$style.countryCodeSelect)},[(r(!0),n(P,null,L(C(Z),t=>(r(),n("option",{key:t.code,value:t.code},u(t.flag)+" "+u(t.dialCode),9,Vs))),128))],2),[[ds,S.value]]),s("i",{class:l(["fas fa-chevron-down",e.$style.selectIcon])},null,2)],2),s("div",{class:l(e.$style.inputWrapper)},[w(s("input",{type:"tel","onUpdate:modelValue":a[11]||(a[11]=t=>O.value=t),class:l([e.$style.phoneInput,{[e.$style.error]:g.value&&!_.value}]),placeholder:"501234567",onInput:a[12]||(a[12]=t=>g.value="")},null,34),[[N,O.value]]),s("i",{class:l(["fas fa-mobile-alt",e.$style.inputIcon])},null,2)],2)],2),g.value&&!_.value?(r(),n("div",{key:0,class:l(e.$style.contactErrorMessage)},u(g.value),3)):d("",!0)],2)):d("",!0)],2)],2)):d("",!0),s("div",{class:l(e.$style.submitContainer)},[s("button",{class:l([e.$style.navButton,e.$style.submit]),onClick:Ee,disabled:!me.value||U.value||!be.value&&!D.value},[U.value?(r(),n("i",Ls)):(r(),n("i",Us)),s("span",null,u(U.value?"جاري الإرسال...":"إرسال الاستطلاع"),1)],10,Ps)],2)],2)):(r(),n("div",Fs,[s("div",{class:l(e.$style.questionContainer)},[i.value?(r(),n("div",{key:0,class:l(e.$style.currentQuestion)},[s("div",{class:l(e.$style.questionHeader)},[s("div",{class:l(e.$style.questionBadge)},[s("span",{class:l(e.$style.questionIndex)},u(b.value+1),3)],2),s("h2",{class:l(e.$style.questionTitle)},[h(u(i.value.text)+" ",1),i.value.is_required?(r(),n("span",{key:0,class:l(e.$style.required)},"*",2)):d("",!0)],2),i.value.is_required?(r(),n("div",{key:0,class:l(e.$style.requiredNote)},a[56]||(a[56]=[s("i",{class:"fas fa-star"},null,-1),s("span",null,"هذا السؤال مطلوب",-1)]),2)):d("",!0)],2),s("div",{class:l(e.$style.questionInput)},[i.value.question_type==="text"?(r(),n("div",{key:0,class:l(e.$style.inputContainer)},[s("div",{class:l(e.$style.inputWrapper)},[w(s("input",{type:C(J)(i.value.validation_type||"none").type,pattern:C(J)(i.value.validation_type||"none").pattern,class:l([e.$style.textInput,{[e.$style.inputError]:C(z)(i.value.id)}]),"onUpdate:modelValue":a[13]||(a[13]=t=>v.value[i.value.id]=t),maxlength:V("text"),onBlur:a[14]||(a[14]=t=>Se(i.value)),onInput:a[15]||(a[15]=t=>{i.value&&(C(he)(i.value.id),ue(i.value.id,"text",t))}),placeholder:C(J)(i.value.validation_type||"none").placeholder||"اكتب إجابتك هنا..."},null,42,Os),[[Le,v.value[i.value.id]]]),s("i",{class:l(["fas fa-pen",e.$style.inputIcon])},null,2)],2),s("div",{class:l(e.$style.characterCount),"data-warning":A(i.value.id,"text")<100},[s("span",null,u(le(i.value.id))+" / "+u(V("text")),1),A(i.value.id,"text")<100?(r(),n("span",{key:0,class:l(e.$style.remainingWarning)}," ("+u(A(i.value.id,"text"))+" حرف متبقي) ",3)):d("",!0)],10,Ds),C(z)(i.value.id)?(r(),n("div",{key:0,class:l(e.$style.errorMessage)},[a[57]||(a[57]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),s("span",null,u(C(z)(i.value.id)),1)],2)):d("",!0)],2)):i.value.question_type==="textarea"?(r(),n("div",{key:1,class:l(e.$style.inputContainer)},[s("div",{class:l(e.$style.inputWrapper)},[w(s("textarea",{"onUpdate:modelValue":a[16]||(a[16]=t=>v.value[i.value.id]=t),class:l(e.$style.textArea),maxlength:V("textarea"),onInput:a[17]||(a[17]=t=>{i.value&&ue(i.value.id,"textarea",t)}),placeholder:"اكتب إجابتك المفصلة هنا... يمكنك كتابة عدة أسطر",rows:"4"},null,42,Ws),[[N,v.value[i.value.id]]]),s("i",{class:l(["fas fa-align-right",e.$style.inputIcon])},null,2)],2),s("div",{class:l(e.$style.characterCount),"data-warning":A(i.value.id,"textarea")<200},[s("span",null,u(le(i.value.id))+" / "+u(V("textarea")),1),A(i.value.id,"textarea")<200?(r(),n("span",{key:0,class:l(e.$style.remainingWarning)}," ("+u(A(i.value.id,"textarea"))+" حrف متبقي) ",3)):d("",!0)],10,Rs)],2)):i.value.question_type==="single_choice"?(r(),n("div",{key:2,class:l(e.$style.choicesContainer)},[s("div",{class:l(e.$style.choicesTitle)},a[58]||(a[58]=[s("i",{class:"fas fa-dot-circle"},null,-1),s("span",null,"اختر إجابة واحدة:",-1)]),2),(r(!0),n(P,null,L(ne(i.value.options),t=>(r(),n("div",{key:t,class:l([e.$style.choiceOption,{[e.$style.selected]:v.value[i.value.id]===t}]),onClick:ee=>v.value[i.value.id]=t},[s("div",{class:l(e.$style.choiceRadio)},[v.value[i.value.id]===t?(r(),n("div",{key:0,class:l(e.$style.radioSelected)},null,2)):d("",!0)],2),s("span",{class:l(e.$style.choiceText)},u(t),3),v.value[i.value.id]===t?(r(),n("div",{key:0,class:l(e.$style.choiceCheck)},a[59]||(a[59]=[s("i",{class:"fas fa-check"},null,-1)]),2)):d("",!0)],10,Qs))),128))],2)):i.value.question_type==="multiple_choice"?(r(),n("div",{key:3,class:l(e.$style.choicesContainer)},[s("div",{class:l(e.$style.choicesTitle)},a[60]||(a[60]=[s("i",{class:"fas fa-check-square"},null,-1),s("span",null,"يمكنك اختيار أكثر من إجابة:",-1)]),2),(r(!0),n(P,null,L(ne(i.value.options),t=>(r(),n("div",{key:t,class:l([e.$style.choiceOption,{[e.$style.selected]:ge(i.value.id,t)}]),onClick:ee=>Be(i.value.id,t)},[s("div",{class:l(e.$style.choiceCheckbox)},[ge(i.value.id,t)?(r(),n("i",Gs)):d("",!0)],2),s("span",{class:l(e.$style.choiceText)},u(t),3),ge(i.value.id,t)?(r(),n("div",{key:0,class:l(e.$style.choiceCheck)},a[61]||(a[61]=[s("i",{class:"fas fa-check-circle"},null,-1)]),2)):d("",!0)],10,qs))),128))],2)):i.value.question_type==="rating"?(r(),n("div",{key:4,class:l(e.$style.ratingContainer)},[s("div",{class:l(e.$style.ratingTitle)},[a[62]||(a[62]=s("i",{class:"fas fa-star"},null,-1)),s("span",null,"قيم من "+u(Me(i.value.options))+":",1)],2),s("div",{class:l(e.$style.ratingScale)},[(r(!0),n(P,null,L(Ne(i.value.options),t=>(r(),n("button",{key:t,class:l([e.$style.ratingButton,{[e.$style.selected]:v.value[i.value.id]===t}]),onClick:ee=>v.value[i.value.id]=t},[s("span",{class:l(e.$style.ratingNumber)},u(t),3)],10,Hs))),128))],2),s("div",{class:l(e.$style.ratingLabels)},[s("span",null,u(re("min")),1),s("span",null,u(re("max")),1)],2)],2)):i.value.question_type==="yes_no"?(r(),n("div",{key:5,class:l(e.$style.yesNoWrapper)},[s("div",{class:l(e.$style.yesNoTitle)},[s("i",{class:l(["fas fa-question-circle",e.$style.yesNoTitleIcon])},null,2),s("span",{class:l(e.$style.yesNoTitleText)},"سؤال اختيار",2)],2),s("div",{class:l(e.$style.yesNoSubtitle)},"اختر الخيار الذي يناسب رأيك",2),s("div",{class:l(e.$style.yesNoContainer)},[s("div",{class:l(e.$style.yesNoButtons)},[s("button",{class:l([e.$style.yesNoButton,e.$style.yes,{[e.$style.selected]:v.value[i.value.id]==="yes"}]),onClick:a[18]||(a[18]=t=>v.value[i.value.id]="yes"),type:"button","aria-pressed":v.value[i.value.id]==="yes"},[s("i",{class:l(["fas fa-check",e.$style.yesNoButtonIcon])},null,2),s("span",{class:l(e.$style.yesNoButtonText)},"نعم",2),s("div",{class:l(e.$style.yesNoButtonBadge)},a[63]||(a[63]=[s("i",{class:"fas fa-check"},null,-1)]),2)],10,Js),s("button",{class:l([e.$style.yesNoButton,e.$style.no,{[e.$style.selected]:v.value[i.value.id]==="no"}]),onClick:a[19]||(a[19]=t=>v.value[i.value.id]="no"),type:"button","aria-pressed":v.value[i.value.id]==="no"},[s("i",{class:l(["fas fa-times",e.$style.yesNoButtonIcon])},null,2),s("span",{class:l(e.$style.yesNoButtonText)},"لا",2),s("div",{class:l(e.$style.yesNoButtonBadge)},a[64]||(a[64]=[s("i",{class:"fas fa-times"},null,-1)]),2)],10,zs)],2)],2)],2)):d("",!0)],2),q.value?(r(),n("div",{key:0,class:l(e.$style.errorMessage)},[a[65]||(a[65]=s("i",{class:"fas fa-exclamation-triangle"},null,-1)),s("span",null,u(q.value),1)],2)):d("",!0)],2)):d("",!0)],2),(b.value===(((m=f.value.questions)==null?void 0:m.length)||0)-1||fe.value)&&!D.value?(r(),n("div",{key:0,class:l(e.$style.contactSection)},[s("div",{class:l(e.$style.contactContainer)},[s("div",{class:l(e.$style.contactHeader)},[s("h3",{class:l(e.$style.contactTitle)},[s("i",{class:l(ss())},null,2),h(" "+u(ls()),1)],2),s("p",{class:l(e.$style.contactDescription)},u(as()),3)],2),E.value==="email"?(r(),n("div",{key:0,class:l(e.$style.contactInputGroup)},[w(s("input",{type:"email","onUpdate:modelValue":a[20]||(a[20]=t=>F.value=t),class:l([e.$style.contactInput,{[e.$style.error]:g.value&&!x.value}]),placeholder:"your-email@example.com",onInput:a[21]||(a[21]=t=>g.value="")},null,34),[[N,F.value]]),g.value&&!x.value?(r(),n("div",{key:0,class:l(e.$style.contactErrorMessage)},u(g.value),3)):d("",!0)],2)):E.value==="phone"?(r(),n("div",{key:1,class:l(e.$style.phoneContactGroup)},[s("div",{class:l(e.$style.phoneInputContainer)},[s("div",{class:l(e.$style.countrySelector),onClick:a[24]||(a[24]=t=>I.value=!I.value)},[s("span",{class:l(e.$style.countryFlag)},u(Ie.value.flag),3),s("span",{class:l(e.$style.countryCode)},u(S.value),3),s("i",{class:l(["fas fa-chevron-down",{[e.$style.rotated]:I.value}])},null,2),I.value?(r(),n("div",{key:0,class:l(e.$style.countryDropdown),onClick:a[23]||(a[23]=ke(()=>{},["stop"]))},[s("div",{class:l(e.$style.countrySearch)},[w(s("input",{ref_key:"countrySearchInput",ref:we,type:"text",class:l(e.$style.searchInput),placeholder:"البحث...","onUpdate:modelValue":a[22]||(a[22]=t=>M.value=t),onInput:Pe},null,34),[[N,M.value]])],2),s("div",{class:l(e.$style.countryList)},[(r(!0),n(P,null,L(Te.value,t=>(r(),n("div",{key:t.dialCode,class:l(e.$style.countryItem),onClick:ee=>Ve(t)},[s("span",{class:l(e.$style.countryFlag)},u(t.flag),3),s("span",{class:l(e.$style.countryName)},u(t.nameAr),3),s("span",{class:l(e.$style.countryCode)},u(t.dialCode),3)],10,Ks))),128))],2)],2)):d("",!0)],2),w(s("input",{type:"tel","onUpdate:modelValue":a[25]||(a[25]=t=>O.value=t),class:l([e.$style.phoneInput,{[e.$style.error]:g.value&&!_.value}]),placeholder:"501234567",onInput:a[26]||(a[26]=t=>g.value="")},null,34),[[N,O.value]])],2),g.value&&!_.value?(r(),n("div",{key:0,class:l(e.$style.contactErrorMessage)},u(g.value),3)):d("",!0)],2)):d("",!0)],2)],2)):d("",!0),s("div",{class:l(e.$style.formNavigation)},[b.value<(((G=f.value.questions)==null?void 0:G.length)||0)-1?(r(),n("button",{key:0,class:l([e.$style.navButton,e.$style.next]),onClick:je,disabled:!He.value},a[66]||(a[66]=[s("span",null,"السؤال التالي",-1),s("i",{class:"fas fa-arrow-left"},null,-1)]),10,Xs)):d("",!0),b.value===(((H=f.value.questions)==null?void 0:H.length)||0)-1?(r(),n("button",{key:1,class:l([e.$style.navButton,e.$style.submit]),onClick:Ee,disabled:!me.value||U.value||!be.value&&!D.value},[U.value?(r(),n("i",js)):(r(),n("i",Zs)),s("span",null,u(U.value?"جاري الإرسال...":"إرسال الاستطلاع"),1)],10,Ys)):d("",!0),s("div",{class:l(e.$style.navSpacer)},null,2),b.value>0?(r(),n("button",{key:2,class:l(e.$style.navButton),onClick:Ze},a[67]||(a[67]=[s("i",{class:"fas fa-arrow-right"},null,-1),s("span",null,"السؤال السابق",-1)]),2)):d("",!0)],2)]))],2)):k.value&&!ye.value?(r(),n("div",{key:4,class:l(e.$style.errorState)},[s("div",{class:l(e.$style.errorIcon)},[s("i",{class:l(k.value==="هذا الاستطلاع لم يعد متاحًا"?"fas fa-times-circle":"fas fa-exclamation-triangle")},null,2)],2),s("h2",{class:l(e.$style.errorTitle)},u(B.value?"انتهت مهلة الاتصال":k.value==="هذا الاستطلاع لم يعد متاحًا"?"الاستطلاع غير متاح":"حدث خطأ غير متوقع"),3),s("p",{class:l(e.$style.errorMessage)},u(B.value?"انتهت مهلة الاتصال بالخادم. يرجى المحاولة مرة أخرى.":k.value),3),B.value?(r(),n("button",{key:0,class:l(e.$style.secondaryButton),onClick:Ae},a[68]||(a[68]=[s("i",{class:"fas fa-sync-alt"},null,-1),h(" تحديث الصفحة ")]),2)):d("",!0)],2)):(r(),n("div",{key:5,class:l(e.$style.errorState)},[s("div",{class:l(e.$style.errorIcon)},a[69]||(a[69]=[s("i",{class:"fas fa-exclamation-triangle"},null,-1)]),2),s("h2",{class:l(e.$style.errorTitle)},u(B.value?"انتهت مهلة الاتصال":"حدث خطأ غير متوقع"),3),s("p",{class:l(e.$style.errorMessage)},u(B.value?"انتهت مهلة الاتصال بالخادم. يرجى المحاولة مرة أخرى.":"عذراً، لم نتمكن من تحميل الاستطلاع. يرجى المحاولة مرة أخرى."),3),B.value?(r(),n("button",{key:0,class:l(e.$style.secondaryButton),onClick:Ae},a[70]||(a[70]=[s("i",{class:"fas fa-sync-alt"},null,-1),h(" تحديث الصفحة ")]),2)):d("",!0)],2)),os(C(fs),{isVisible:$e.value,onClose:ts},null,8,["isVisible"])],10,gs)}}}),sl={$style:$s},ul=cs(el,[["__cssModules",sl]]);export{ul as default};
