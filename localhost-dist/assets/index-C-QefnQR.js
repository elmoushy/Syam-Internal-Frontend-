import{d as it,y as ot,r as f,c as C,W as V,w as at,g as nt,a as r,b as e,i as U,n as o,p as y,t as n,s as I,v as st,J as N,F as R,e as x,f as E,q as lt,X as m,l as ct,Y as rt,o as u,_ as ut}from"./index-C7bNMsZb.js";const dt=["disabled","title"],ft=["disabled","title"],vt=["placeholder"],_t={value:""},pt={value:"unread"},yt={value:"read"},mt={value:""},gt=["value"],kt={value:""},bt=["value"],$t=["disabled"],ht=["disabled"],St=["checked","onChange"],Ct=["onClick"],Bt=["onClick","title"],wt=["disabled"],At=["disabled"],It=it({__name:"Notifications",setup(Ae){const M=ot(),G=ct(),v=f([]),T=f(null),l=f([]),k=f(!1),b=f(!1),_=f(!1),B=f(""),$=f(""),h=f(""),S=f(""),c=f({current:1,pageSize:20,total:0,totalPages:0}),d=C(()=>M.currentLanguage),s=C(()=>M.t),Y=C(()=>v.value.filter(t=>!t.is_read).length),P=C(()=>{const t={};return Object.keys(V).forEach(i=>{t[i]=s.value(`notifications.types.${i}`)}),t}),j=C(()=>({low:s.value("notifications.priorities.low"),normal:s.value("notifications.priorities.normal"),high:s.value("notifications.priorities.high"),urgent:s.value("notifications.priorities.urgent")})),w=async(t=1)=>{k.value=!0;try{const i={page:t,page_size:c.value.pageSize,lang:d.value};B.value&&(i.search=B.value),$.value==="read"&&(i.is_read=!0),$.value==="unread"&&(i.is_read=!1),h.value&&(i.type=h.value),S.value&&(i.priority=S.value);const g=await m.getNotifications(i);v.value=g.results,c.value={current:t,pageSize:c.value.pageSize,total:g.count,totalPages:Math.ceil(g.count/c.value.pageSize)}}catch(i){console.error("Failed to load notifications:",i),v.value=[]}finally{k.value=!1}},A=async()=>{try{const t=await m.getNotificationStats(d.value);T.value=t.data}catch(t){console.error("Failed to load notification stats:",t)}},F=async()=>{await Promise.all([w(c.value.current),A()])},q=async()=>{if(!b.value){b.value=!0;try{await m.markAllAsRead(d.value),v.value.forEach(t=>t.is_read=!0),l.value=[],await A()}catch(t){console.error("Failed to mark all as read:",t)}finally{b.value=!1}}},L=async t=>{try{await m.updateNotification(t.id,!0),t.is_read=!0}catch(i){console.error("Failed to mark notification as read:",i)}},J=async t=>{await L(t),t.action_url&&G.push(t.action_url)},Q=t=>{const i=l.value.indexOf(t);i>-1?l.value.splice(i,1):l.value.push(t)},W=()=>{l.value=[]},X=async()=>{if(!_.value){_.value=!0;try{await m.bulkAction({notification_ids:l.value,action:"mark_read"}),v.value.forEach(t=>{l.value.includes(t.id)&&(t.is_read=!0)}),l.value=[],await A()}catch(t){console.error("Failed to bulk mark as read:",t)}finally{_.value=!1}}},K=async()=>{if(!(_.value||!window.confirm(d.value==="ar"?"هل أنت متأكد من حذف الإشعارات المحددة؟":"Are you sure you want to delete the selected notifications?"))){_.value=!0;try{await m.bulkAction({notification_ids:l.value,action:"delete"}),v.value=v.value.filter(i=>!l.value.includes(i.id)),l.value=[],await A()}catch(i){console.error("Failed to bulk delete:",i)}finally{_.value=!1}}},z=t=>{t>=1&&t<=c.value.totalPages&&w(t)},Z=t=>d.value==="ar"?m.formatNotificationTimeAr(t):m.formatNotificationTime(t),tt=t=>V[t]||"fas fa-bell",O=t=>rt[t]||"#3b82f6";let H;const et=()=>{clearTimeout(H),H=setTimeout(()=>{w(1)},500)};return at([$,h,S],()=>{w(1)}),nt(()=>{F()}),(t,i)=>{var g,D;return u(),r("div",{class:o(t.$style.notificationsPage)},[e("div",{class:o(t.$style.pageHeader)},[e("div",{class:o(t.$style.headerContent)},[e("div",{class:o(t.$style.titleSection)},[e("h1",{class:o(t.$style.pageTitle)},[i[6]||(i[6]=e("i",{class:"fas fa-bell"},null,-1)),y(" "+n(s.value("notifications.title")),1)],2),e("p",{class:o(t.$style.pageSubtitle)},n(((g=T.value)==null?void 0:g.total_notifications)||0)+" "+n(s.value("notifications.stats.total").toLowerCase())+", "+n(((D=T.value)==null?void 0:D.unread_notifications)||0)+" "+n(s.value("notifications.stats.unread").toLowerCase()),3)],2),e("div",{class:o(t.$style.headerActions)},[e("button",{onClick:F,class:o(t.$style.actionButton),disabled:k.value,title:s.value("notifications.actions.refresh")},[e("i",{class:o(["fas fa-sync-alt",{"fa-spin":k.value}])},null,2),y(" "+n(s.value("notifications.refresh")),1)],10,dt),e("button",{onClick:q,class:o(t.$style.actionButton),disabled:b.value||Y.value===0,title:s.value("notifications.actions.markAllRead")},[e("i",{class:o(["fas fa-check-double",{"fa-spin":b.value}])},null,2),y(" "+n(s.value("notifications.markAllRead")),1)],10,ft)],2)],2)],2),e("div",{class:o(t.$style.filtersSection)},[e("div",{class:o(t.$style.filterRow)},[e("div",{class:o(t.$style.searchBox)},[i[7]||(i[7]=e("i",{class:"fas fa-search"},null,-1)),I(e("input",{"onUpdate:modelValue":i[0]||(i[0]=a=>B.value=a),type:"text",placeholder:s.value("notifications.search"),class:o(t.$style.searchInput),onInput:et},null,42,vt),[[st,B.value]])],2),e("div",{class:o(t.$style.filterControls)},[I(e("select",{"onUpdate:modelValue":i[1]||(i[1]=a=>$.value=a),class:o(t.$style.filterSelect)},[e("option",_t,n(s.value("notifications.showAll")),1),e("option",pt,n(s.value("notifications.showUnread")),1),e("option",yt,n(s.value("notifications.showRead")),1)],2),[[N,$.value]]),I(e("select",{"onUpdate:modelValue":i[2]||(i[2]=a=>h.value=a),class:o(t.$style.filterSelect)},[e("option",mt,n(s.value("notifications.type")),1),(u(!0),r(R,null,x(P.value,(a,p)=>(u(),r("option",{key:p,value:p},n(a),9,gt))),128))],2),[[N,h.value]]),I(e("select",{"onUpdate:modelValue":i[3]||(i[3]=a=>S.value=a),class:o(t.$style.filterSelect)},[e("option",kt,n(s.value("notifications.priority")),1),(u(!0),r(R,null,x(j.value,(a,p)=>(u(),r("option",{key:p,value:p},n(a),9,bt))),128))],2),[[N,S.value]])],2)],2)],2),l.value.length>0?(u(),r("div",{key:0,class:o(t.$style.bulkActions)},[e("div",{class:o(t.$style.bulkInfo)},n(l.value.length)+" "+n(d.value==="ar"?"عنصر محدد":"items selected"),3),e("div",{class:o(t.$style.bulkButtons)},[e("button",{onClick:X,class:o(t.$style.bulkButton),disabled:_.value},[i[8]||(i[8]=e("i",{class:"fas fa-check"},null,-1)),y(" "+n(s.value("notifications.markAsRead")),1)],10,$t),e("button",{onClick:K,class:o([t.$style.bulkButton,t.$style.deleteButton]),disabled:_.value},[i[9]||(i[9]=e("i",{class:"fas fa-trash"},null,-1)),y(" "+n(s.value("notifications.delete")),1)],10,ht),e("button",{onClick:W,class:o([t.$style.bulkButton,t.$style.cancelButton])},[i[10]||(i[10]=e("i",{class:"fas fa-times"},null,-1)),y(" "+n(d.value==="ar"?"إلغاء":"Cancel"),1)],2)],2)],2)):U("",!0),e("div",{class:o(t.$style.notificationsList)},[k.value?(u(),r("div",{key:0,class:o(t.$style.loading)},[e("div",{class:o(t.$style.loadingSpinner)},i[11]||(i[11]=[e("i",{class:"fas fa-spinner fa-spin"},null,-1)]),2),e("p",null,n(d.value==="ar"?"جاري التحميل...":"Loading notifications..."),1)],2)):v.value.length===0?(u(),r("div",{key:1,class:o(t.$style.emptyState)},[e("div",{class:o(t.$style.emptyIcon)},i[12]||(i[12]=[e("i",{class:"fas fa-bell-slash"},null,-1)]),2),e("h3",null,n(s.value("notifications.noNotifications")),1),e("p",null,n(s.value("notifications.noNotificationsDesc")),1)],2)):(u(),r("div",{key:2,class:o(t.$style.notificationsGrid)},[(u(!0),r(R,null,x(v.value,a=>(u(),r("div",{key:a.id,class:o([t.$style.notificationCard,{[t.$style.unread]:!a.is_read,[t.$style.selected]:l.value.includes(a.id)}])},[e("div",{class:o(t.$style.notificationSelect)},[e("input",{type:"checkbox",checked:l.value.includes(a.id),onChange:p=>Q(a.id),class:o(t.$style.checkbox)},null,42,St)],2),e("div",{class:o(t.$style.priorityIndicator),style:E({backgroundColor:O(a.priority)})},null,6),e("div",{class:o(t.$style.notificationMain),onClick:p=>J(a)},[e("div",{class:o(t.$style.notificationHeader)},[e("div",{class:o(t.$style.notificationIcon)},[e("i",{class:o(tt(a.notification_type)),style:E({color:O(a.priority)})},null,6)],2),e("div",{class:o(t.$style.notificationMeta)},[e("span",{class:o(t.$style.notificationType)},n(P.value[a.notification_type]),3),e("span",{class:o(t.$style.notificationTime)},n(Z(a.created_at)),3)],2)],2),e("div",{class:o(t.$style.notificationContent)},[e("h4",{class:o(t.$style.notificationTitle)},n(a.title_localized),3),e("p",{class:o(t.$style.notificationBody)},n(a.body_localized),3)],2),e("div",{class:o(t.$style.notificationActions)},[a.is_read?U("",!0):(u(),r("button",{key:0,onClick:lt(p=>L(a),["stop"]),class:o(t.$style.actionBtn),title:s.value("notifications.markAsRead")},i[13]||(i[13]=[e("i",{class:"fas fa-check"},null,-1)]),10,Bt))],2)],10,Ct)],2))),128))],2)),e("div",{class:o(t.$style.pagination)},[e("button",{onClick:i[4]||(i[4]=a=>z(c.value.current-1)),disabled:c.value.current<=1,class:o(t.$style.paginationBtn)},[i[14]||(i[14]=e("i",{class:"fas fa-chevron-right"},null,-1)),y(" "+n(d.value==="ar"?"السابق":"Previous"),1)],10,wt),e("div",{class:o(t.$style.paginationInfo)},n(d.value==="ar"?`صفحة ${c.value.current} من ${c.value.totalPages}`:`Page ${c.value.current} of ${c.value.totalPages}`),3),e("button",{onClick:i[5]||(i[5]=a=>z(c.value.current+1)),disabled:c.value.current>=c.value.totalPages,class:o(t.$style.paginationBtn)},[y(n(d.value==="ar"?"التالي":"Next")+" ",1),i[15]||(i[15]=e("i",{class:"fas fa-chevron-left"},null,-1))],10,At)],2)],2)],2)}}}),Tt="_notificationsPage_1x2tm_45",Nt="_pageHeader_1x2tm_65",Rt="_headerContent_1x2tm_73",xt="_titleSection_1x2tm_161",Mt="_pageTitle_1x2tm_173",Pt="_pageSubtitle_1x2tm_221",Ft="_headerActions_1x2tm_241",Lt="_actionButton_1x2tm_257",zt="_spin_1x2tm_1",Ot="_filtersSection_1x2tm_373",Ht="_filterRow_1x2tm_381",Dt="_searchBox_1x2tm_419",Vt="_searchInput_1x2tm_451",Ut="_filterControls_1x2tm_493",Et="_filterSelect_1x2tm_507",Gt="_bulkActions_1x2tm_569",Yt="_slideDown_1x2tm_1",jt="_bulkInfo_1x2tm_623",qt="_bulkButtons_1x2tm_635",Jt="_bulkButton_1x2tm_635",Qt="_deleteButton_1x2tm_701",Wt="_cancelButton_1x2tm_711",Xt="_notificationsList_1x2tm_723",Kt="_notificationsGrid_1x2tm_731",Zt="_notificationCard_1x2tm_741",te="_unread_1x2tm_801",ee="_selected_1x2tm_835",ie="_notificationSelect_1x2tm_847",oe="_checkbox_1x2tm_861",ae="_priorityIndicator_1x2tm_915",ne="_notificationMain_1x2tm_929",se="_notificationHeader_1x2tm_947",le="_notificationIcon_1x2tm_961",ce="_notificationMeta_1x2tm_993",re="_notificationType_1x2tm_1009",ue="_notificationTime_1x2tm_1031",de="_notificationContent_1x2tm_1045",fe="_notificationTitle_1x2tm_1053",ve="_notificationBody_1x2tm_1079",_e="_notificationActions_1x2tm_1103",pe="_actionBtn_1x2tm_1119",ye="_primaryAction_1x2tm_1161",me="_loading_1x2tm_1185",ge="_emptyState_1x2tm_1187",ke="_loadingSpinner_1x2tm_1215",be="_emptyIcon_1x2tm_1217",$e="_pagination_1x2tm_1297",he="_paginationInfo_1x2tm_1327",Se="_paginationControls_1x2tm_1339",Ce="_paginationBtn_1x2tm_1351",Be={notificationsPage:Tt,pageHeader:Nt,headerContent:Rt,titleSection:xt,pageTitle:Mt,pageSubtitle:Pt,headerActions:Ft,actionButton:Lt,"fa-spin":"_fa-spin_1x2tm_353",spin:zt,filtersSection:Ot,filterRow:Ht,searchBox:Dt,searchInput:Vt,filterControls:Ut,filterSelect:Et,bulkActions:Gt,slideDown:Yt,bulkInfo:jt,bulkButtons:qt,bulkButton:Jt,deleteButton:Qt,cancelButton:Wt,notificationsList:Xt,notificationsGrid:Kt,notificationCard:Zt,unread:te,selected:ee,notificationSelect:ie,checkbox:oe,priorityIndicator:ae,notificationMain:ne,notificationHeader:se,notificationIcon:le,notificationMeta:ce,notificationType:re,notificationTime:ue,notificationContent:de,notificationTitle:fe,notificationBody:ve,notificationActions:_e,actionBtn:pe,primaryAction:ye,loading:me,emptyState:ge,loadingSpinner:ke,emptyIcon:be,pagination:$e,paginationInfo:he,paginationControls:Se,paginationBtn:Ce},we={$style:Be},Te=ut(It,[["__cssModules",we]]);export{Te as default};
